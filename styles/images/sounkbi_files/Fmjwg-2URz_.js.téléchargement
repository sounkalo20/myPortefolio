;/*FB_PKG_DELIM*/

__d("LSBumpE2EEMetadataThread",["LSCancelTaskByQueueName","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return d[0]=new c.Map(),d[0].set("bump_timestamp_ms",a[1]),d[0].set("thread_key",a[0]),d[0].set("bumped_by_local_device_send",a[2]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[0].set("wa_jid",f),d[0].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[0].set("message_product_type",f),d[0].set("is_message_deletion",!1),d[1]=d[0].get("thread_key"),d[0],c.sp(b("LSCancelTaskByQueueName"),c.i64.to_string(d[1]),c.i64.cast([0,389]))},function(e){return d[2]=new c.Map(),d[2].set("bump_timestamp_ms",a[1]),d[2].set("thread_key",a[0]),d[2].set("bumped_by_local_device_send",a[2]),d[2].set("tam_thread_subtype",c.i64.cast([0,0])),d[2].set("wa_jid",f),d[2].set("message_ephemeral_duration_in_sec",c.i64.cast([0,0])),d[2].set("message_product_type",f),d[2].set("is_message_deletion",!1),d[3]=d[2].get("thread_key"),d[2],d[4]=c.toJSON(d[2]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[3]),c.i64.cast([0,389]),d[4],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]))}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSCreateE2EEMetadataThread",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return d[0]=new c.Map(),d[0].set("wa_jid",a[0]),d[0].set("offline_thread_key",a[1]),d[0].set("thread_type",a[2]),d[0].set("folder_type",a[3]),d[0].set("bump_timestamp_ms",a[4]),d[0].set("tam_thread_subtype",c.i64.cast([0,0])),d[1]=d[0].get("offline_thread_key"),d[0],d[2]=c.toJSON(d[0]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,388]),d[2],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSUpdateE2EEMetadataParticipants",["LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return d[0]=new c.Map(),d[0].set("thread_key",a[0]),d[1]=d[0].get("thread_key"),d[0],d[2]=c.toJSON(d[0]),c.sp(b("LSIssueNewTask"),c.i64.to_string(d[1]),c.i64.cast([0,394]),d[2],f,f,c.i64.cast([0,0]),c.i64.cast([0,0]),f,f,c.i64.cast([0,0]))},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSUpsertAttachmentRange",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.seq([function(c){return b.fe(b.db.table(17).fetch([[[a[0],a[1]]]]),function(a){return a["delete"]()})},function(c){return b.db.table(17).add({threadKey:a[0],mediaGroup:a[1],minTimestampMs:a[2],maxTimestampMs:b.i64.cast([2328,1316134911]),hasMoreBefore:a[3],hasMoreAfter:!1,isLoadingBefore:!1,isLoadingAfter:!1})}])},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("MAWCatQuery_instagramRelayOperation",[],(function(a,b,c,d,e,f){e.exports="4877036382414550"}),null);
__d("MAWCatQuery.instagram.graphql",["MAWCatQuery_instagramRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{alias:null,args:null,concreteType:"SecureMessageOverWACATGraphResult",kind:"LinkedField",name:"secure_message_over_wa_cat_query",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"encrypted_serialized_cat",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"expiration_time_in_seconds",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"MAWCatQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"MAWCatQuery",selections:a},params:{id:b("MAWCatQuery_instagramRelayOperation"),metadata:{},name:"MAWCatQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("WAFixedSizeMap",[],(function(a,b,c,d,e,f){a=function(){function a(a){a=a.max;this.$1=new Map();this.$2=new Map();this.$3=0;this.$4=100;this.$4=a}var b=a.prototype;b.has=function(a){return this.$1.has(a)};b.get=function(a){return this.$1.get(a)};b.set=function(a,b){this.$1.set(a,b);this.$2.set(this.$3,a);this.$3+=1;b=this.$2.get(this.$3-this.$4-1);b!=null&&(this.$1["delete"](b),this.$2["delete"](this.$3-this.$4-1))};b.clear=function(){this.$1.clear(),this.$2.clear(),this.$3=0};b.size=function(){return this.$1.size};return a}();f.FixedSizeMap=a}),66);
__d("MAWJobActionsV2",["MAWTransactionMode","Promise","WAFixedSizeMap","WAHex","WATimeUtils"],(function(a,b,c,d,e,f,g){"use strict";function h(a){return new(b("Promise"))(function(b,c){a.onsuccess=b,a.onerror=c})}function i(a){return h(a).then(function(a){return a.target.result})}function j(a,c,e){return new(b("Promise"))(function(b,f){var g=a(d("MAWTransactionMode").READONLY).index(c);g=g.openCursor(IDBKeyRange.only(e));var h=[];g.onsuccess=function(a){a=a.target.result;if(!a){b(h);return}h.push(a.value);a["continue"]()};g.onerror=function(a){return f(a)}})}var k=new(d("WAFixedSizeMap").FixedSizeMap)({max:100});function a(a,c){var e,f=c.args,g=c.scheduleConfig,h=c.type,k=c.uniqKey;c=c.version;c=c===void 0?1:c;e=JSON.stringify([h,(e=k)!=null?e:d("WAHex").randomHex(32)]);var m={backedOffCount:0,current:f,original:f,scheduleConfig:g,startTime:d("WATimeUtils").unixTime(),step:"$unstarted",stepFirstStartTime:null,stepHardStartCountAfterTimeout:0,stepUnexpectedErrorCount:0,type:h,uniqKey:e,version:c,waitUntil:null},n=function(){var b,c=a().add(m),d=i(c);if(m.uniqKey==null&&typeof ((b=c.transaction)==null?void 0:b.commit)==="function")try{c.transaction.commit()}catch(a){}return d.then(function(a){return{id:a,newlyCreated:!0}})};if(k!=null)return j(a,"uniqKey",e).then(function(c){if(c.length===0)return n();var d=[],e=null;c.forEach(function(b){b.step!=="$finished"?e=b:d.push(l(a,b.jobId))});return b("Promise").all(d).then(function(){return e!=null?{id:e.jobId,newlyCreated:!1}:n()})});else return n()}function l(a,b){return i(a()["delete"](b))}function c(a,b){return i(a().get(b))}function e(a,b){return i(a().put(b))}function f(a){return i(a().getAll())}function m(a){return h(a().clear()).then(function(){})}g.recentFinishedJobsCache=k;g.maybeCreateJob=a;g.deletePersistedJob=l;g.readPersistedJob=c;g.updatePersistedJob=e;g.readAllPersistedJobs=f;g.clearJobs=m}),98);
__d("MAWEncryptedBackupsStateManager",["MAWEBSwitch"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case 1:return;case 3:c("MAWEBSwitch").set(!0);return;case 2:case 4:default:c("MAWEBSwitch").set(!1);return}}function b(a){return a===4||a===3}g.setEncryptedBackupsState=a;g.eligibleForEBUX=b}),98);
__d("MAWLocalStorage",["LocalStorageWrapper","MWLocalStorageErrorHandler","WALogger"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["not storage found"]);h=function(){return a};return a}function i(a){d("WALogger").LOG([a])}function j(a){d("WALogger").ERROR([a])}function a(){return d("LocalStorageWrapper").getStorage(i)}function b(){return d("LocalStorageWrapper").isLocalStorageAvailable(i)}function c(a,b,c){return d("LocalStorageWrapper").setItemGuarded(a,b,c,j,d("MWLocalStorageErrorHandler").onQuotaExceeded)}function e(a,b){a==null?d("WALogger").ERROR(h()):a.removeItem(b)}g.getStorage=a;g.isLocalStorageAvailable=b;g.setItemGuarded=c;g.removeItemGuarded=e}),98);
__d("MWTabCommunicationChannel",["MAWLocalStorage"],(function(a,b,c,d,e,f,g){"use strict";var h=typeof window!=="undefined"?window:self;function i(a){var b=d("MAWLocalStorage").getStorage(),c=function(c){d("MAWLocalStorage").setItemGuarded(b,a,JSON.stringify(c))},e=function(c){window.removeEventListener("storage",c),d("MAWLocalStorage").removeItemGuarded(b,a)},f=function(a){window.addEventListener("storage",a)},g=function(b){return b!=null&&b.key===a&&typeof b.newValue==="string"?JSON.parse(b.newValue):null};return{getMessage:g,onRequestReceived:function(a){var b=function(b){b=g(b);b!=null&&a(b)};f(b);return{release:function(){e(b)}}},sendMessage:c,stopWaitingForReply:e,waitForReply:f}}function j(a){var b=new h.BroadcastChannel(a),c=new Set();b.addEventListener("message",function(a){c.forEach(function(b){b(a)})});var d=function(a){c.add(a)},e=function(a){c["delete"](a)};a=function(a){b.postMessage(JSON.stringify(a))};var f=function(a){return a!=null&&typeof a.data==="string"?JSON.parse(a.data):null};return{getMessage:f,onRequestReceived:function(a){var b=function(b){b=f(b);b!=null&&a(b)};d(b);return{release:function(){e(b)}}},sendMessage:a,stopWaitingForReply:e,waitForReply:d}}function a(a){return h.BroadcastChannel!=null?j(a):i(a)}g.getChannel=a}),98);
__d("MWTabCommunication",["MWTabCommunicationChannel","Promise","clearTimeout","pageID","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a,b){var c=this;this.$5=function(a){a=c.$4.getMessage(a);a!=null&&a.a==="sb"&&a.t!==c.tabID()&&a.r===c.tabID()&&a.k!=null&&(c.$2&&c.$2(a.k),c.$4.stopWaitingForReply(c.$5),c.$2=null)};this.$1=a;this.$3=b!=null?b:500;this.$4=d("MWTabCommunicationChannel").getChannel(a)}var e=a.prototype;e.tabID=function(){return c("pageID")};e.$6=function(){var a={a:"r",t:this.tabID()};this.$4.sendMessage(a)};e.listenToRequest=function(a){var b=this,c=function(c){if(c.a==="r"&&c.t!==b.tabID()){c={a:"sb",k:a(),r:c.t,t:b.tabID()};b.$4.sendMessage(c)}};return this.$4.onRequestReceived(c)};e.$7=function(){var a=this;return new(b("Promise"))(function(b){a.$2=b,a.$4.waitForReply(a.$5),a.$6()})};e.request=function(a,d){var e=this,f,g=function(){f!=null&&c("clearTimeout")(f)};return b("Promise").race([this.$7().then(function(b){e.$4.stopWaitingForReply(e.$5);return a(b)}),new(b("Promise"))(function(a){f=c("setTimeout")(function(){a(d()),e.$4.stopWaitingForReply(e.$5)},e.$3)})]).then(function(a){g();return a})};return a}();g.MWTabCommunication=a}),98);
__d("MAWVaultMaterialsStorage",["MAWVaultMaterials","MWTabCommunication","Promise"],(function(a,b,c,d,e,f,g){"use strict";e="mw_exchange_vm";var h=new(d("MWTabCommunication").MWTabCommunication)(e);function a(){return h.listenToRequest(d("MAWVaultMaterials").materialsToString)}function c(){if(d("MAWVaultMaterials").hasVaultBeenSetup())return b("Promise").resolve(d("MAWVaultMaterials").getVaultMaterials());else{var a=function(a){return d("MAWVaultMaterials").fromStringToMaterials(a)};return h.request(a,function(){}).then(function(a){return d("MAWVaultMaterials").initializeVaultMaterials(a)})}}g.listenToVaultMaterialsRequest=a;g.setupVaultMaterials=c}),98);
__d("MAWChatJid",["FBLogger","I64","MAWJidUtils","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){b=d("MAWJidUtils").threadIdForChatJid(b);return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("mi_act_mapping_table").index("jid")).getKeyRange(d("I64").of_string(b))).then(function(a){if(a!=null)return a.serverThreadKey;throw c("FBLogger")("messenger_e2ee_web").mustfixThrow("Tried to convert a jid to thread key but couldn't find a corresponding row in the mapping table. This can mean that there is a race condition between the time a thread was created on the WA backend, and the time it was inserted into the mapping table. i.e. this function is called before the fn that inserts the mapping into the mapping table")})}function e(a,e){try{return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("mi_act_mapping_table").index("jid")).getKeyRange(d("I64").of_string(e))).then(function(a){if(a!=null)return a.serverThreadKey})}catch(a){c("FBLogger")("messenger_e2ee_web").catching(a).warn("Invalid chatJid: "+e);return b("Promise").reject(a)}}g.toThreadKey=a;g.toThreadKeyMaybe=e}),98);
__d("MAWThreadId",["I64","LSMessagingThreadTypeUtil","ODS","ReQL","WALogger","asyncToGeneratorRuntime","recoverableViolation","unrecoverableViolation"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return h.apply(this,arguments)}function h(){h=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("mi_act_mapping_table").index("chat_id")).getKeyRange(d("I64").of_int32(b))));if(a!=null)return a.serverThreadKey;throw c("unrecoverableViolation")("Tried to convert a rowId to thread key but couldn't find a\n      corresponding row in the mapping table. This can mean that\n      there is a race condition between the time a thread was created\n      on the WA backend, and the time it was inserted into the mapping table.\n      i.e. this function is called before the fn that inserts the mapping\n      into the mapping table","messenger_web_product")});return h.apply(this,arguments)}var i=new Set();function e(a,b){return j.apply(this,arguments)}function j(){j=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("mi_act_mapping_table").index("chat_id")).getKeyRange(d("I64").of_int32(b))));if(a!=null){i["delete"](b);return a.serverThreadKey}i.has(b)||(d("WALogger").LOG(["[Occamadillo] Thread id: "+b.toString()+" is not yet in miActMapping table."]),d("ODS").bumpEntityKey(5765,"thread_not_in_miActMapping","[Occamadillo] Thread id: "+b.toString()+" is not yet in miActMapping table."),i.add(b));return});return j.apply(this,arguments)}function f(a){c("recoverableViolation")("Checking if a threadKey is a secure thread key in Occamadillo. We should be\n      checking the thread's thread type instead","messenger_web_product");return!1}function k(a,b){return l.apply(this,arguments)}function l(){l=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(b)));if(a==null)return;return a.threadType});return l.apply(this,arguments)}function m(a,b){return n.apply(this,arguments)}function n(){n=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){a=(yield k(a,b));return a==null?!1:d("LSMessagingThreadTypeUtil").isSecure(a)});return n.apply(this,arguments)}function o(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("threads")).getKeyRange(b))}g.toThreadKey_DEPRECATED=a;g.toThreadKeyMaybe_DEPRECATED=e;g.isThreadId=f;g.isSecureThreadId=m;g.getThreadFromJid=o}),98);
__d("LSCoreClientFolderType",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:0,PENDING:1,OTHER:2,SPAM:3,ARCHIVED:4,HIDDEN:5,RESTRICTED:15});f["default"]=a}),66);
__d("MessagingFolderTag",[],(function(a,b,c,d,e,f){a=Object.freeze({INBOX:"inbox",OTHER:"other",SPAM:"spam",PENDING:"pending",MONTAGE:"montage",HIDDEN:"hidden",LEGACY:"legacy",DISABLED:"disabled",PAGE_BACKGROUND:"page_background",PAGE_DONE:"page_done",BLOCKED:"blocked",COMMUNITY:"community",RESTRICTED:"restricted",BC_PARTNERSHIP:"bc_partnership",E2EE_CUTOVER:"e2ee_cutover",INTEROP:"interop",ARCHIVED:"archived",UNKNOWN:""});f["default"]=a}),66);
__d("MAWFolderUtils",["LSCoreClientFolderType","LSIntEnum","MAWFolderTypes","MessagingFolderTag"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(a){case d("MAWFolderTypes").PENDING:return c("MessagingFolderTag").PENDING;case d("MAWFolderTypes").OTHER:return c("MessagingFolderTag").OTHER;case d("MAWFolderTypes").SPAM:return c("MessagingFolderTag").SPAM;case d("MAWFolderTypes").ARCHIVED:return c("MessagingFolderTag").UNKNOWN;default:return c("MessagingFolderTag").INBOX}}function b(a){switch(a){case d("MAWFolderTypes").PENDING:return d("LSIntEnum").ofNumber(-101);case d("MAWFolderTypes").OTHER:return d("LSIntEnum").ofNumber(-102);case d("MAWFolderTypes").SPAM:return d("LSIntEnum").ofNumber(-103);case d("MAWFolderTypes").ARCHIVED:return d("LSIntEnum").ofNumber(-110);default:return d("LSIntEnum").ofNumber(-100)}}function e(a){switch(a){case d("MAWFolderTypes").INBOX:return d("LSIntEnum").ofNumber(c("LSCoreClientFolderType").INBOX);case d("MAWFolderTypes").PENDING:return d("LSIntEnum").ofNumber(c("LSCoreClientFolderType").PENDING);case d("MAWFolderTypes").OTHER:return d("LSIntEnum").ofNumber(c("LSCoreClientFolderType").OTHER);case d("MAWFolderTypes").SPAM:return d("LSIntEnum").ofNumber(c("LSCoreClientFolderType").SPAM);case d("MAWFolderTypes").ARCHIVED:return d("LSIntEnum").ofNumber(c("LSCoreClientFolderType").ARCHIVED)}}function f(a){switch(a){case d("LSIntEnum").ofNumber(-1):return d("LSIntEnum").ofNumber(-101);case d("LSIntEnum").ofNumber(-2):return d("LSIntEnum").ofNumber(-102);case d("LSIntEnum").ofNumber(-3):return d("LSIntEnum").ofNumber(-103);case d("LSIntEnum").ofNumber(-10):return d("LSIntEnum").ofNumber(-110);default:return d("LSIntEnum").ofNumber(-100)}}g.getMessagingFolderTag=a;g.getClientSystemFolder=b;g.systemFolderToLSCoreClientFolder=e;g.systemFolderToClientSystemFolder=f}),98);
__d("MAWFrontendMediaUtils",["MAWDbMedia"],(function(a,b,c,d,e,f,g){"use strict";function a(a){if(a==="image/gif")return{mediaType:d("MAWDbMedia").MEDIA_TYPE.GIF,serverMediaType:"gif"};if(a==="image/webp")return{mediaType:d("MAWDbMedia").MEDIA_TYPE.STICKER,serverMediaType:"sticker"};a=a.split("/")[0];switch(a){case"image":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.IMAGE,serverMediaType:"image"};case"video":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.VIDEO,serverMediaType:"video"};case"audio":return{mediaType:d("MAWDbMedia").MEDIA_TYPE.PTT,serverMediaType:"ptt"};case"application":default:return{mediaType:d("MAWDbMedia").MEDIA_TYPE.DOCUMENT_FILE,serverMediaType:"document"}}}g.getMediaTypeAndServerMediaTypeFromBlob=a}),98);
__d("MAWImageUtils",["Promise","err"],(function(a,b,c,d,e,f,g){"use strict";var h="image/jpeg";e=100;function i(a,d){d===void 0&&(d=!0);var e;return new(b("Promise"))(function(b,f){e=new Image();var g=/^(?:data|blob):/.test(a);d&&!g&&e.setAttribute("crossOrigin","anonymous");e.onload=b;e.onabort=function(){f(function(){throw c("err")("Error loading image from provided URL")})};e.onerror=function(){f(function(){throw c("err")("Wrong blob type")})};e.src=a}).then(function(){return e})}function j(a,c,d){d===void 0&&(d=!1);var e=40*1024;if(a.toBlob)return new(b("Promise"))(function(b){a.toBlob(b,c)}).then(function(f){return d&&f.size>=e?new(b("Promise"))(function(b){a.toBlob(b,c,e/f.size)}):f});else return b("Promise").resolve(window.dataURLtoBlob(a.toDataURL(c))).then(function(f){return d&&f.size>=e?b("Promise").resolve(window.dataURLtoBlob(a.toDataURL(c,e/f.size))):f})}function a(a,d){return i(a).then(function(a){var b=document.createElement("canvas");b.width=a.naturalWidth;b.height=a.naturalHeight;var c=b.getContext("2d");l(b);c.drawImage(a,0,0);return j(b,d).then(function(b){return{blob:b,height:a.naturalHeight,width:a.naturalWidth}})})["catch"](function(a){return b("Promise").reject(function(){throw c("err")(a)})})}function d(a,b){return i(a).then(function(a){var c=document.createElement("canvas"),d=a.naturalWidth,e=a.naturalHeight,f=c.getContext("2d");e=m(e,d,b);c.width=e.width;c.height=e.height;var g=c.width,i=c.height;k(c);f.drawImage(a,0,0,g,i);return j(c,h,!0).then(function(a){return a.arrayBuffer().then(function(a){return{height:i,jpegThumbnail:a,width:g}})})})}function k(a){var b=a.getContext("2d");b.fillStyle="rgb(247,247,247)";b.fillRect(0,0,a.width,a.height)}function l(a){var b=a.getContext("2d");b.fillStyle="rgb(255,255,255)";b.fillRect(0,0,a.width,a.height)}function m(a,b,c){b=b!=null?b:c;a=a!=null?a:c;b>a?b>c&&(a*=c/b,b=c):a>c&&(b*=c/a,a=c);return{height:Math.max(a,1),width:Math.max(b,1)}}g.TYPE_JPEG=h;g.IMG_THUMB_MAX_EDGE=e;g.canvasToBlob=j;g.urlToFile=a;g.urlToThumbnail=d;g.boundHeightWidth=m}),98);
__d("EphemeralMediaViewMode",[],(function(a,b,c,d,e,f){a=Object.freeze({READ_ONCE:0,REPLAYABLE:1,PERMANENT:2});f["default"]=a}),66);
__d("MAWRavenUtils",["EphemeralMediaViewMode","MAWMsg","RavenMessagingState"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralMediaState.PERMANENT:return c("RavenMessagingState").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN:return c("RavenMessagingState").UNSEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN:return c("RavenMessagingState").SEEN;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.REPLAYED:return c("RavenMessagingState").REPLAYED;case d("MAWMsg").MAWRavenMsgEphemeralMediaState.EXPIRED:return c("RavenMessagingState").EXPIRED}};b=function(a){switch(a){case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return c("EphemeralMediaViewMode").PERMANENT;case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:return c("EphemeralMediaViewMode").REPLAYABLE;case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return c("EphemeralMediaViewMode").READ_ONCE}};function a(a,b){switch(b){case d("MAWMsg").MAWRavenMsgEphemeralType.VIEW_ONCE:return a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN?c("RavenMessagingState").SEEN:h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.ALLOW_REPLAY:if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.UNSEEN)return c("RavenMessagingState").SEEN;else if(a===d("MAWMsg").MAWRavenMsgEphemeralMediaState.SEEN)return c("RavenMessagingState").REPLAYED;return h(a);case d("MAWMsg").MAWRavenMsgEphemeralType.KEEP_IN_CHAT:return h(a)}}g.getEphemeralMediaState=h;g.getEphemeralMediaViewMode=b;g.getNextRavenMessageEphemeralState=a}),98);
__d("MAWUpdateClientRestoreStatusOperationType",[],(function(a,b,c,d,e,f){"use strict";a=0;b=1;f.upsertClientRestoreStatus=a;f.removeClientRestoreStatus=b}),66);
__d("MAWEBRestoreStatus",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["NOT_STARTED","IN_PROGRESS","RESTORE_COMPLETED"]);f.EBInitialRestoreStatus=a}),66);
__d("MAWStateContext.react",["MAWEBRestoreStatus","MAWProtocolQueueConst","err","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i=h.createContext,j=h.useCallback,k=h.useContext,l=h.useEffect,m=h.useRef,n=h.useState;h={eBInitialRestoreStatus:d("MAWEBRestoreStatus").EBInitialRestoreStatus.NOT_STARTED,ephemeralSettings:{},messageLatencies:{},offlineQueueCount:0,offlineQueueProgressDownloaded:0,offlineQueueProgressProcessed:0,offlineQueueSyncState:d("MAWProtocolQueueConst").OfflineConsumerStatus.Initializing,unArchivedSelfDeviceChangeAlerts:0};function a(){var a=k(p)(),b=a.dispatch;return j(function(a,c){c===void 0&&(c=Date.now()),b({optimisticMsgId:a,tag:"OptimisticSendMessage",timestamp:c})},[b])}function b(){var a=k(p)(),b=a.dispatch;return j(function(a,c){b({tag:"EphemeralSettingsUpdatedForUI",value:{chatJid:a,ephemeralSettingArgs:c}})},[b])}function e(){var a=k(q),b=a.dispatch;return j(function(){b({tag:"ClearEphemeralSettings"})},[b])}function f(){var a=k(q),b=a.dispatch;return j(function(a){b({tag:"EBInitialRestoreStatus",value:a})},[b])}var o={dispatch:function(a){throw c("err")("MAW Dispatch not implemented")},state:h,subscriptions:new Set()},p=i(function(){return o}),q=i(o);function r(a){var b=k(p)(),c=b.state,d=b.subscriptions;b=n(function(){return a(c)});var e=b[0],f=b[1],g=m(e);l(function(){var b=function(b){b=a(b);b!==g.current&&(g.current=b,f(b))};d.add(b);return function(){d["delete"](b)}},[d,a]);return e}g.initialState=h;g.useDispatchOptimisticSendMessage=a;g.useDispatchEphemeralSettingsUpdatedForUI=b;g.useDispatchClearEphemeralSettings=e;g.useDispatchEBInitialRestoreStatus=f;g.MAWNonRerenderingStateContext=p;g.MAWStateContext=q;g.useMAWSelector=r}),98);
__d("MAWStateContextProvider.react",["MAWProtocolQueueConst","MAWStateContext.react","react","useUnsafeRef_DEPRECATED"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");b=d("react");var i=b.useCallback,j=b.useEffect,k=b.useMemo,l=b.useReducer,m=function(a,b){switch(b.tag){case"OptimisticSendMessage":var c;return babelHelpers["extends"]({},a,{messageLatencies:babelHelpers["extends"]({},a.messageLatencies,(c={},c[b.optimisticMsgId]={sent:b.timestamp},c))});case"NewMsg":case"MsgUpdated":var e,f;c=b.value.ack;var g=b.value.msgId;e=(e=b.value.offlineMsg)==null?void 0:e.msgId;e!=null&&a.messageLatencies[e]!=null&&(a.messageLatencies[g]=a.messageLatencies[e],delete a.messageLatencies[e]);e=a.messageLatencies[g];if((e==null?void 0:e.sent)!=null&&(e==null?void 0:e.acked)!=null)return a;e=(e==null?void 0:e.sent)||Date.now();c=c!==0?Date.now():void 0;return babelHelpers["extends"]({},a,{messageLatencies:babelHelpers["extends"]({},a.messageLatencies,(f={},f[g]={acked:c,sent:e},f))});case"InitOfflineQueueSyncProgress":g=b.value;return babelHelpers["extends"]({},a,{offlineQueueProgressDownloaded:g});case"InitOfflineQueueConsumerSyncProgress":c=b.value;return babelHelpers["extends"]({},a,{offlineQueueProgressProcessed:c});case"InitOfflineQueueSyncStart":e=b.value;return babelHelpers["extends"]({},a,{offlineQueueCount:e});case"InitOfflineQueueSyncComplete":return babelHelpers["extends"]({},a,{offlineQueueSyncState:d("MAWProtocolQueueConst").OfflineConsumerStatus.Complete});case"InitOfflineQueueSyncUIReady":return babelHelpers["extends"]({},a,{offlineQueueSyncState:d("MAWProtocolQueueConst").OfflineConsumerStatus.UIReady});case"UnArchivedSelfDeviceChangeAlerts":f=b.value;return babelHelpers["extends"]({},a,{unArchivedSelfDeviceChangeAlerts:f});case"EphemeralSettingsUpdatedForUI":g=b.value;c=g.chatJid;e=g.ephemeralSettingArgs;f=e.ephemeralExpirationInSec;g=e.ephemeralLastUpdatedOrSetTimestamp;e=c;return babelHelpers["extends"]({},a,{ephemeralSettings:babelHelpers["extends"]({},a.ephemeralSettings,(c={},c[e]={ephemeralExpirationInSec:f,ephemeralLastUpdatedOrSetTimestamp:g},c))});case"ClearEphemeralSettings":return babelHelpers["extends"]({},a,{ephemeralSettings:{}});case"EBInitialRestoreStatus":return babelHelpers["extends"]({},a,{eBInitialRestoreStatus:b.value})}return a};function a(a){a=a.children;var b=l(m,d("MAWStateContext.react").initialState),c=b[0],e=b[1],f=k(function(){return new Set()},[]);b=k(function(){return{dispatch:e,state:c,subscriptions:f}},[c,e,f]);var g=n(b),o=i(function(){return g.current},[g]);j(function(){f==null?void 0:f.forEach(function(a){return a(c)})},[c,f]);return h.jsx(d("MAWStateContext.react").MAWStateContext.Provider,{value:b,children:h.jsx(d("MAWStateContext.react").MAWNonRerenderingStateContext.Provider,{value:o,children:a})})}a.displayName=a.name+" [from "+f.id+"]";function n(a){var b=c("useUnsafeRef_DEPRECATED")(a);b.current=a;return b}g["default"]=a}),98);
__d("WAShiftTimer",["WAErr"],(function(a,b,c,d,e,f,g){a=function(){function a(a){var b=this;this.$2=0;this.$3=0;this.ts=0;this.$4=0;this.$5=0;this.$6=0;this.$7=void 0;this.$8=function(){var a=b.$7,c=b.$1;b.$3=0;b.$2=0;b.ts=0;b.$4=0;b.$5=0;b.$6=0;b.$7=void 0;c(a)};this.onOrBefore=function(a,c){h(a);var d=Date.now();d=d+a;var e=b.$5;if(e!==0&&e<d)return;e=b.$6;if(e!==0&&d<e)return;b.$5=d;!b.$3&&(!b.$2||d<b.ts)&&b.$9(d,a,c)};this.forceRunNow=function(a){b.$2&&clearTimeout(b.$2),b.$3&&cancelAnimationFrame(b.$3),b.$7=a,b.$8()};this.cancel=function(){b.$2&&clearTimeout(b.$2),b.$3&&cancelAnimationFrame(b.$3),b.$2=0,b.$3=0,b.ts=0,b.$4=0,b.$5=0,b.$6=0,b.$7=void 0};this.$1=a}var b=a.prototype;b.onOrBeforeRepaint=function(a){if(this.$3)return;var b=Date.now(),c=this.$6;if(c!==0&&b<c)return;c=this.$5;(c===0||b<c)&&(this.$5=b);this.$2&&(clearTimeout(this.$2),this.$2=0);(!this.ts||this.ts>b)&&(this.ts=b);this.$7=a;this.$3=requestAnimationFrame(this.$8)};b.onOrAfter=function(a,b){h(a);var c=Date.now();c=c+a;var d=this.$6;if(d!==0&&c<d)return;d=this.$5;if(d!==0&&d<c)return;this.$6=c;(!this.$2||this.ts<c)&&this.$9(c,a,b)};b.debounce=function(a,b){h(a),this.$10(Date.now(),a,b)};b.debounceAndCap=function(a,b,c){h(a);h(b);var d=Date.now();b=d+b;var e=this.$6,f=this.$5;(e===0||e<=b)&&(f===0||b<f)&&(this.$5=b);this.$10(d,a,c)};b.forceRunNowIfScheduled=function(){this.$2?(clearTimeout(this.$2),this.$8()):this.$3&&(cancelAnimationFrame(this.$3),this.$8())};b.isScheduled=function(){return this.$2!==0||this.$3!==0};b.$10=function(a,b,c){var d=a+b,e=this.$6;if(e!==0&&d<e)return;e=this.ts;var f=this.$5;f!==0&&f<d?e<f&&this.$9(f,f-a,c):e<d&&this.$9(d,b,c)};b.$9=function(a,b,c){this.$3&&(cancelAnimationFrame(this.$3),this.$3=0);this.$7=c;this.ts=a;if(this.$2){c=a-this.$4;if(-16<c&&c<16)return;clearTimeout(this.$2)}this.$2=setTimeout(this.$8,b);this.$4=a};return a}();function h(a){if(!(a>=0))throw c("WAErr")("ShiftTimer must be given delay >= 0")}g.ShiftTimer=a}),98);
__d("WABridgeBatcher",["WAShiftTimer"],(function(a,b,c,d,e,f,g){var h=20,i=1e3;a=function(){function a(a,b){var c=this;this.$1=null;this.$4=h;this.$5=Date.now();this.$6=new(d("WAShiftTimer").ShiftTimer)(function(){var a=c.$1;if(a==null)return;c.$1=null;c.$2(a)});this.$2=b;this.$3=a}var b=a.prototype;b.addEvent=function(a){var b=this.$1;this.$1=b?this.$3(b,a):[a];if(this.$6.isScheduled())return;b=this.$4;if(b<1){a=Date.now();var c=Math.max(a-this.$5,0)/i;b=Math.min(b+c,h);this.$4=b;this.$5=a}b>=1?(c=0,this.$4=b-1):(c=Math.ceil(i*(1-b)),this.$4=0);this.$6.onOrBefore(c)};b.cancel=function(){this.$1=null,this.$6.cancel()};return a}();g.BridgeBatcher=a}),98);
__d("WAPromiseCallSync",["Promise"],(function(a,b,c,d,e,f){function a(a,c){try{for(var d=arguments.length,e=new Array(d>2?d-2:0),f=2;f<d;f++)e[f-2]=arguments[f];return b("Promise").resolve(a.apply(c,e))}catch(a){return b("Promise").reject(a)}}f.promiseCallSync=a}),66);
__d("WAPromiseManagement",["WAPromiseCallSync"],(function(a,b,c,d,e,f,g){function a(a){var b=null,c=function(){b||(b=d("WAPromiseCallSync").promiseCallSync(a)["finally"](function(){b=null}));return b};c.isPending=function(){return!!b};return c}function b(a,b){var c=new Map();return function(d){var e=a(d),f=c.get(e);if(f)return f;try{f=Promise.resolve(b(d))}catch(a){f=Promise.reject(a)}d=f["finally"](function(){return void c["delete"](e)});c.set(e,d);return d}}var h=new Set();function c(a){h.add(a),a["finally"](function(){h["delete"](a)})}g.nullaryCacheWhilePending=a;g.cacheWhilePending=b;g.preventGarbageCollection=c}),98);
__d("WACrossWorkerPortal",["Promise","WABridgeBatcher","WAErr","WALogger","WAPromiseManagement"],(function(a,b,c,d,e,f,g){function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["absorbPortal: transferring request #",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unexpected non-result to call"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unexpected result to cast: ",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge unrecognized result ",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," response of ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge "," request for ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge queuing "," msgs"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge sending "," across (delayed)"]);o=function(){return a};return a}function p(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge received msg on old port"]);p=function(){return a};return a}function q(){var a=babelHelpers.taggedTemplateLiteralLoose(["Bridge updating port"]);q=function(){return a};return a}var r=function(){function a(a,b,c,e){var f=this;this.port=null;this.$2=1;this.openRequests=new Map();this.listeners=new Set();this.$1=a;this.sendStream=new(d("WABridgeBatcher").BridgeBatcher)(b,function(a){f.$3(a)});c.forEach(function(b){a.setNamespaceHandler(b,f.$4(b))});this.clientId=e}var e=a.prototype;e.$5=function(){var a=this.clientId!=null?this.clientId+"_":"";return""+a+this.$2++};e.addListener=function(a){var b=this;this.listeners.add(a);return function(){return b.listeners["delete"](a)}};e.setPort=function(a){var b=this;d("WALogger").LOG(q());this.port=a;this.sendStream.cancel();a.onmessage=function(c){if(b.port!==a){d("WALogger").WARN(p()).devConsole(c.data);return}c=c.data;if(!c)return;c.forEach(function(c){b.$6(c,"incoming"),b.$7(a,c)})};this.openRequests.forEach(function(a){a=a.request;d("WALogger").LOG(o(),a.name);b.sendStream.addEvent({type:"request",content:a})})};e.getBridge=function(){return this.$1};e.$4=function(a){var b=this;return function(c,d,e,f){b.$8(a,c,d,e,f)}};e.$8=function(a,b,c,d,e){var f=this.$5();a={requestId:f,expectsResponse:!!d,namespace:a,name:b,arg:c,silentLog:e};this.openRequests.set(f,{request:a,resolver:d});this.sendStream.addEvent({type:"request",content:a})};e.$9=function(a,b){if(a!==this.port)return;this.sendStream.addEvent({type:"result",content:b})};e.$3=function(a){var b=this,c=this.port;if(!c){d("WALogger").LOG(n(),a.length);return}c.postMessage(a);a.forEach(function(a){return b.$6(a,"outgoing")})};e.$6=function(a,b){this.listeners.forEach(function(c){return c(a,b)})};e.$7=function(a,e){var f=this;if(e.type==="request"){var g=e.content,h=g.namespace,n=g.name,o=g.requestId,p=g.arg,q=g.expectsResponse,r=g.silentLog;r||d("WALogger").LOG(m(),o,n);g=this.$1;if(q){q=g.sendAndReceive(h,n,p,r).then(function(b){f.$9(a,{requestId:o,type:"success",result:b,silentLog:r})},function(b){f.$9(a,{requestId:o,type:"error",result:String(b),silentLog:r})});d("WAPromiseManagement").preventGarbageCollection(q)}else{g.fireAndForget(h,n,p,r);q={type:"result",content:{requestId:o,type:"handled",silentLog:r}};this.$6(q,"outgoing");a.postMessage([q])}}else{e.type;g=e.content;h=g.requestId;n=g.type;p=g.result;q=g.silentLog;q||d("WALogger").LOG(l(),h,n);e=this.openRequests.get(h);if(!e){d("WALogger").WARN(k(),h);return}switch(n){case"success":case"error":this.openRequests["delete"](h);g=e.resolver;g?g(n==="success"?p:b("Promise").reject(c("WAErr")(p))):d("WALogger").ERROR(j(),p);break;case"handled":e.resolver?d("WALogger").ERROR(i()):this.openRequests["delete"](h);break}}};return a}();function a(a,b,c,d){return new r(a,c,b,d)}function e(a){var b;(b=a.port)==null?void 0:b.close();a.port=null;a.sendStream.cancel();b=a.openRequests;a.openRequests=new Map();var c=a.getBridge();b.forEach(function(a){var b=a.request;a=a.resolver;var e=b.namespace,f=b.name,g=b.arg,i=b.silentLog;d("WALogger").LOG(h(),b.requestId);a?a(c.sendAndReceive(e,f,g,i)):c.fireAndForget(e,f,g,i)})}g.CrossWorkerPortal=r;g.attachPortal=a;g.killPortalAndSendPendingToBridge=e}),98);
__d("MAWCrossWorkerPortal",["FBLogger","WACrossWorkerPortal","pageID"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e){if(h!=null)return h;h=d("WACrossWorkerPortal").attachPortal(a,b,e,c("pageID"));return h}function b(){if(h==null){c("FBLogger")("messenger_e2ee_web").warn("Trying to kill portal before its setup");return}d("WACrossWorkerPortal").killPortalAndSendPendingToBridge(h)}g.getOrCreateCrossWorkerPortal=a;g.killPortalWhenWorkerTerminating=b}),98);
__d("IGDBundleResource",["IGDAWMainWebWorkerResource"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=c("IGDAWMainWebWorkerResource")}),98);
__d("MAWClientConsistencyRefresh",["ClientConsistencyEventEmitter","CurrentUser"],(function(a,b,c,d,e,f,g){"use strict";function a(a){switch(c("CurrentUser").getAppID()){case 772021112871879:c("ClientConsistencyEventEmitter").emit("hardRefresh",a);break;default:c("ClientConsistencyEventEmitter").emit("softRefresh",a)}}g["default"]=a}),98);
__d("WorkerUtils",[],(function(a,b,c,d,e,f){"use strict";function b(){try{return"WorkerGlobalScope"in a&&a instanceof a.WorkerGlobalScope}catch(a){return!1}}function c(){try{return"SharedWorkerGlobalScope"in a&&a instanceof a.SharedWorkerGlobalScope}catch(a){return!1}}function d(){return"SharedWorker"in a&&typeof a.SharedWorker==="function"}f.isWorkerContext=b;f.isSharedWorkerContext=c;f.isSharedWorkerSupported=d}),66);
__d("shouldUseMAWSharedWorker",["QE2Logger","WorkerUtils","qex"],(function(a,b,c,d,e,f,g){"use strict";function a(){var a;return d("WorkerUtils").isSharedWorkerSupported()&&((a=c("qex")._("430"))!=null?a:!1)}function b(){d("WorkerUtils").isSharedWorkerSupported()&&d("QE2Logger").logExposureForUser("armadillo_web_worker")}g.shouldUseMAWSharedWorker=a;g.logExposureForMAWSharedWorker=b}),98);
__d("MAWInit",["ExecutionEnvironment","MAWEBSwitch","MAWGating","MAWTTRC","QPLUserFlow","UserTimingUtils","asyncToGeneratorRuntime","gkx","performanceNow","qpl","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h=c("qpl")._(25310776,"6155"),i=!1,j=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;c.error=null;c.name="MAWInitError";c.message=a;c.error=null;return c}var c=a.prototype;c.catching=function(a){this.error=a;return this};return a}(babelHelpers.wrapNativeSuper(Error)),k=!1;function l(){if(k)return;k=!0;c("QPLUserFlow").addAnnotations(h,{bool:{armadillo_init_sync_api_improvements:c("gkx")("1115"),isEBEnabled:c("MAWEBSwitch").isEnabled(),isIndexedDbEarEnabled:!0,isTlcPublicUser:d("MAWGating").isTlcPublicUser(),useSharedWorker:d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()}})}var m=!1;function a(){if(m)return;d("MAWTTRC").markEvent("maw_init_start");m=!0;c("QPLUserFlow").start(h,{cancelOnUnload:!0,onFlowTimeout:function(){i=!0,d("MAWTTRC").addStringAnnotation("mawInitFailReason","timeout")},timeoutInMs:c("ExecutionEnvironment").canUseDOM?6e4:0});l()}function n(a){if(!m||i)return;l();c("QPLUserFlow").addPoint(h,a)}function e(a,b){var d;if(!m||i)return;c("QPLUserFlow").addAnnotations(h,{bool:(d={},d[a]=b,d)})}function f(a){l(),i=!0,c("QPLUserFlow").addAnnotations(h,{string:{failReason:a}}),c("QPLUserFlow").endFailure(h,"maw_init_fail"),k=!1,d("MAWTTRC").addStringAnnotation("mawInitFailReason",a),d("MAWTTRC").fail("maw_init_end")}function o(a){l(),i=!0,c("QPLUserFlow").addAnnotations(h,{string:{cancelReason:a}}),c("QPLUserFlow").endCancel(h),k=!1,d("MAWTTRC").addStringAnnotation("mawInitCancelReason",a),d("MAWTTRC").markEvent("maw_init_end"),d("MAWTTRC").cancel()}function p(){l(),i=!0,c("QPLUserFlow").endSuccess(h),d("MAWTTRC").markEvent("maw_init_end"),k=!1}function q(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=c("performanceNow")(),f=a+"_start",g=a+"_end";n(f);f=(yield b());n(g);c("gkx")("8518")&&d("UserTimingUtils").measureModern(a,{end:c("performanceNow")(),start:e});return f});return r.apply(this,arguments)}e={addBoolAnnotation:e,cancel:o,endSuccess:p,fail:f,logPoint:n,measurePerformance:q,start:a};g.MAWInitError=j;g.MAWInit=e}),98);
__d("SharedWorkerDevChangeManager",["gkx"],(function(a,b,c,d,e,f,g){"use strict";var h=!1,i=new Set();function a(a){return!h||i.has(a)}function b(a){h&&i.add(a)}g.shouldUseCurrentWorkerIfDev=a;g.trackCreatedWorker=b}),98);
__d("SharedWorkerInitFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("4266");b=d("FalcoLoggerInternal").create("shared_worker_init",a);e=b;g["default"]=e}),98);
__d("WebStorageLockManager",["FBLogger","LocalStorageWrapper","LockManager","Promise","Run","clearInterval","err","promiseDone","regeneratorRuntime","setInterval","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";function h(a){c("FBLogger")("messenger_browser_clients").mustfix(a)}function a(a,e){var f="Failed to execute 'request' on 'LockManager'",g="Lock broken by another request with the 'steal' option.",i=function(a,b,c){var d=a.get(b);if(d!=null)return d;d=c();a.set(b,d);return d};try{var j=d("LocalStorageWrapper").getStorage(h),k=function(a,b){d("LocalStorageWrapper").setItemGuarded(j,a,b,h,e==null?void 0:e.onQuotaExceeded)},l=function(a){d("LocalStorageWrapper").removeItemGuarded(j,a,h)},m=function(a){return d("LocalStorageWrapper").getItemGuarded(j,a,h)},n=function(){function a(a,b){this.lockName=a,this.tabId=b,this.lockA=this.lockName+"-a",this.lockB=this.lockName+"-b"}var d=a.prototype;d.run=function(a){return this.$1(a,0)};d.$1=function(a,d){var e=this,f=function(b){return window.requestAnimationFrame(function(){return e.$1(a,d+1).then(b)})},g=function(a){return m(a)==null};k(this.lockA,this.tabId);return new(b("Promise"))(function(b){var h=function(){try{a(),b()}finally{l(e.lockB),l(e.lockA)}};g(e.lockB)||d>10?(d>10&&c("FBLogger")("messenger_comet").warn("web-lock polyfill: Had to steal lock"),k(e.lockB,e.tabId),m(e.lockA)===e.tabId?h():window.requestAnimationFrame(function(){m(e.lockB)===e.tabId?h():f(b)})):f(b)})};return a}(),o=function(){function a(b){this.tabId=b,this.lock=new n(a.tabsKey,b),c("promiseDone")(this.$1()),this.$2(),this.keepOnlyTabs(function(b){return a.isAlive(b)})}a.isAlive=function(b){b=m(a.$3(b));return b==null?!1:Date.now()-parseFloat(b)<1e3};var e=a.prototype;e.keepOnlyTabs=function(c){return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(this.lock.run(function(){var b;b=JSON.parse((b=m(a.tabsKey))!=null?b:"[]").filter(c);b.length>0?k(a.tabsKey,JSON.stringify(b)):l(a.tabsKey)}));case 2:case"end":return d.stop()}},null,this)};e.$2=function(){var b=a.$3(this.tabId);k(b,Date.now().toString());var e=c("setInterval")(function(){k(b,Date.now().toString())},500);d("Run").onUnload(function(){c("clearInterval")(e),l(b)})};e.$1=function(){var e=this;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(this.lock.run(function(){var b;b=JSON.parse((b=m(a.tabsKey))!=null?b:"[]");k(a.tabsKey,JSON.stringify([].concat(b,[e.tabId])))}));case 2:d("Run").onUnload(function(){return c("promiseDone")(e.keepOnlyTabs(function(a){return a!==e.tabId}))});case 3:case"end":return f.stop()}},null,this)};a.$3=function(a){return"$navigator.heartbeat-"+a};return a}();o.tabsKey="$navigator.heartbeat-tabs";var p=function(){function a(b,e){var f=this;this.requests=new Map();this.name=b;this.tabId=e;this.queueKey=a.storagePrefix+"-"+b+"-q";this.currentOwnerKey=a.storagePrefix+"-"+b+"-o";this.lock=new n(a.storagePrefix+"-"+b,this.tabId);d("Run").onUnload(function(){c("promiseDone")(f.keepOnlyRequests(function(a){return(a==null?void 0:a.t)!==f.tabId}))})}var e=a.prototype;e.enqueue=function(d,e,a){var f=this,g,h,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:g=c("uuidv4")().toString();h={t:this.tabId,u:g};i=function(){d(null),f.markRequestReleased(g)};j=function(){d(g),f.markRequestReleased(g)};this.requests.set(g,[function(){return d(g)},function(){e(),f.markRequestReleased(g)}]);if(!((a==null?void 0:a.signal)!=null)){k.next=9;break}a.signal.onabort=function(){c("promiseDone")(f.keepOnlyRequests(function(a){return(a==null?void 0:a.u)!==g})),j()};if(!a.signal.aborted){k.next=9;break}return k.abrupt("return",j());case 9:k.next=11;return b("regeneratorRuntime").awrap(this.lock.run(function(){var b=f.getOwner();(a==null?void 0:a.steal)===!0&&f.$1(b==null?void 0:b.u);if(b==null||(a==null?void 0:a.steal)===!0||!o.isAlive(b.t))f.$2(f.currentOwnerKey,babelHelpers["extends"]({},h,(a==null?void 0:a.steal)===!0?{s:!0}:{})),f.$3(g);else if((a==null?void 0:a.ifAvailable)!==!0){b=f.getQueue();b.push(h);f.$2(f.queueKey,b)}else i()}));case 11:case"end":return k.stop()}},null,this)};e.dequeue=function(c){var d=this,e,f;return b("regeneratorRuntime").async(function(g){while(1)switch(g.prev=g.next){case 0:f=null;g.next=3;return b("regeneratorRuntime").awrap(this.lock.run(function(){var b=d.getOwner();if((b==null?void 0:b.t)!==d.tabId||(b==null?void 0:b.u)!==c)return;b=d.getQueue();b=a.getNextOwner(b);var e=b[0];b=b[1];f=e;d.$2(d.currentOwnerKey,e);d.$2(d.queueKey,b)}));case 3:this.$3((e=f)==null?void 0:e.u);case 4:case"end":return g.stop()}},null,this)};e.storageChangedOnOtherTab=function(a,c){var d=this;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(!(a==="o")){e.next=3;break}e.next=3;return b("regeneratorRuntime").awrap(this.lock.run(function(){var a=d.getOwner();if(a==null)return;d.$3(a==null?void 0:a.u);if(a.s===!0){a=c==null?void 0:c.oldValue;if(a!=null){a=JSON.parse(a);a.t===d.tabId&&d.$1(a.u)}}}));case 3:case"end":return e.stop()}},null,this)};e.getQueue=function(){var a;return(a=this.$4(this.queueKey))!=null?a:[]};e.getOwner=function(){return this.$4(this.currentOwnerKey)};a.getQueueNameAndStorageType=function(b){if(!b.startsWith(a.storagePrefix))return null;var d=b.slice(a.storagePrefix.length+1,b.length-2),e=b.charAt(b.length-1);switch(e){case"q":case"o":case"a":case"b":break;default:throw c("err")("Queue was stored with a suffix other than q or o. This is either a bug in the web lock api polyfill code, or it means that something overwrote localStorage with a weird key. Key: "+b)}return[d,e]};a.getNextOwner=function(a){for(var b=0;b<a.length;b+=1)if(o.isAlive(a[b].t))return[a[b],a.slice(b+1)];return[null,[]]};e.$4=function(a){a=m(a);return a!=null?JSON.parse(a):null};e.$2=function(a,b){b=b==null||Array.isArray(b)&&b.length===0?null:JSON.stringify(b);b==null?l(a):k(a,b)};e.keepOnlyRequests=function(c){var d=this;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(this.lock.run(function(){var b=d.getOwner(),e=d.getQueue().filter(c);if(c(b))d.$2(d.queueKey,e);else{b=a.getNextOwner(e);e=b[0];b=b[1];d.$2(d.currentOwnerKey,e);d.$2(d.queueKey,b)}}));case 2:case"end":return e.stop()}},null,this)};e.markRequestReleased=function(a){a!=null&&this.requests["delete"](a)};e.$3=function(a){if(a!=null){a=this.requests.get(a);if(a!=null){a=a[0];a()}}};e.$1=function(a){if(a!=null){a=this.requests.get(a);if(a!=null){a[0];a=a[1];a()}}};return a}();p.storagePrefix="$navigator.locks";var q=function(){function a(a){this.$1=new Map(),this.storage=d("LocalStorageWrapper").getStorage(h),this.tabId=a,new o(this.tabId),c("promiseDone")(this.$2()),this.$3()}var e=a.prototype;e.request=function(){var a=this;for(var e=arguments.length,h=new Array(e),i=0;i<e;i++)h[i]=arguments[i];return new(b("Promise"))(function(e,i){c("promiseDone")(function(){var j,k,e,l,m,n,o;return b("regeneratorRuntime").async(function(p){while(1)switch(p.prev=p.next){case 0:k=h[0];e=h.length===3?h[1]:null;l=h.length===2?h[1]:h[2];if(!k.startsWith("-")){p.next=5;break}throw new DOMException("Names cannot start with '-'.",f);case 5:if(!((e==null?void 0:e.ifAvailable)===!0&&(e==null?void 0:e.signal)!=null)){p.next=7;break}throw new DOMException("The 'signal' and 'ifAvailable' options cannot be used together.",f);case 7:m=a.$4(k);p.next=10;return b("regeneratorRuntime").awrap(new(b("Promise"))(function(a){c("promiseDone")(m.enqueue(a,function(){i(new DOMException(g,f))},e))}));case 10:n=p.sent;if(!((e==null?void 0:(j=e.signal)==null?void 0:j.aborted)===!0)){p.next=13;break}throw new DOMException("The request was aborted.",f);case 13:p.prev=13;p.next=16;return b("regeneratorRuntime").awrap(l(n!=null?{mode:(o=e==null?void 0:e.mode)!=null?o:d("LockManager").LockMode.Exclusive,name:k}:null));case 16:p.prev=16;if(!(n!=null)){p.next=20;break}p.next=20;return b("regeneratorRuntime").awrap(m.dequeue(n));case 20:m.markRequestReleased(n);return p.finish(16);case 22:case"end":return p.stop()}},null,this,[[13,,16,22]])}(),e,i)})};e.query=function(){var a=[],c=[];for(var e=this.$5(),f=Array.isArray(e),g=0,e=f?e:e[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var h;if(f){if(g>=e.length)break;h=e[g++]}else{g=e.next();if(g.done)break;h=g.value}h=h;if(h!=null){var i={mode:d("LockManager").LockMode.Exclusive,name:h.name};if(h.getOwner()!=null)a.push(i);else for(var h=h.getQueue(),j=Array.isArray(h),k=0,h=j?h:h[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var l;if(j){if(k>=h.length)break;l=h[k++]}else{k=h.next();if(k.done)break;l=k.value}l;c.push(i)}}}return b("Promise").resolve({held:a,pending:c})};e.$4=function(a){var b=this;return i(this.$1,a,function(){return new p(a,b.tabId)})};e.$3=function(){var a=this;window.addEventListener("storage",function(b){var d=b.key;if(b.storageArea!==a.storage||d==null)return;d=p.getQueueNameAndStorageType(d);if(d==null)return;var e=d[0];d=d[1];c("promiseDone")((e=a.$4(e))==null?void 0:e.storageChangedOnOtherTab(d,b))})};e.$2=function(){return b("regeneratorRuntime").async(function(a){while(1)switch(a.prev=a.next){case 0:a.next=2;return b("regeneratorRuntime").awrap(b("Promise").all(this.$5().map(function(a){return a==null?void 0:a.keepOnlyRequests(function(a){return a==null?!1:o.isAlive(a.t)})})));case 2:case"end":return a.stop()}},null,this)};e.$5=function(){var a=this;return j==null?[]:Object.keys(j).map(function(b){b=p.getQueueNameAndStorageType(b);if(b==null)return;b=b[0];return a.$4(b)})};return a}();return new q(a)}catch(a){return null}}g.make=a}),98);
__d("SharedWorkerLockManager",["Deferred","FBLogger","WebStorageLockManager","emptyFunction","pageID","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";var h="shared_worker_mutex",i=15e3;function j(){var a;a=(a=window)==null?void 0:(a=a.navigator)==null?void 0:a.locks;if(a!=null)return a;var b=d("WebStorageLockManager").make(c("pageID"));return b!=null?{request:function(a,c){return b.request(a,c)}}:null}function k(a){c("setTimeout")(function(){a.isSettled()||(c("FBLogger")("comet_infra").warn("[SharedWorkerLockManager]: lock timed out in %s ms",i),a.resolve())},i)}function a(a){var b=j();if(b==null){c("FBLogger")("comet_infra").warn("Unable to initialize lock manager");a(c("emptyFunction"));return}var d=new(c("Deferred"))();c("promiseDone")(b.request(h,function(){k(d);a(function(){return d.resolve()});return d.getPromise()}))}g.withWorkerLock=a}),98);
__d("SharedWorkerStatusLock",[],(function(a,b,c,d,e,f){"use strict";var g="sw-lock";function h(a){return g+"-"+a}function a(){var a=null,b;function c(){var c=self,d=c.navigator.locks;d instanceof c.LockManager&&(b==null&&(b=new c.Promise(function(b){a=b})),d.request(h(c.name),function(a){if(a!=null)return b}))}function d(){a==null?void 0:a(),b=null,a=null}return{init:c,release:d}}f.getStatusLockName=h;f.getStatusLock=a}),66);
__d("validateSharedWorkerReference",["ConstUriUtils","isRelativeURL","isSameOrigin","memoize"],(function(a,b,c,d,e,f,g){"use strict";var h=c("memoize")(function(){return d("ConstUriUtils").getUri(window.location.href)});function i(a){var b=h(),e=d("ConstUriUtils").getUri(a);e=b!=null&&e!=null?c("isSameOrigin")(e,b):!1;return e||c("isRelativeURL")(a)}function a(a){if(a==null||typeof a!=="object")return null;var b=a.rev,c=a.spin_time,d=a.url;a=a.version;return typeof b!=="number"||typeof c!=="number"||a!=null&&a!==1&&a!==2||!Number.isInteger(b)||!Number.isInteger(c)||typeof d!=="string"||!i(d)?null:{rev:b,spin_time:c,url:d,version:(b=a)!=null?b:1}}g["default"]=a}),98);
__d("SharedWorkerStorageManager",["Deferred","FBLogger","Promise","WebAsyncStorage","validateSharedWorkerReference"],(function(a,b,c,d,e,f,g){"use strict";var h="__swbundle__",i={};function j(a){return""+h+a}function k(a){var b=new(c("Deferred"))();c("WebAsyncStorage").removeItem(j(a),function(c){if(c)return b.reject(c);i[a]=null;b.resolve()});return b.getPromise()}function l(a,b){var d=new(c("Deferred"))();c("WebAsyncStorage").setItem(j(a),b,function(c){if(c)return d.reject(c);i[a]=b;d.resolve()});return d.getPromise()}function m(a){var b=new(c("Deferred"))();c("WebAsyncStorage").getItem(j(a),function(c,d){if(c)return b.reject(c);i[a]=d;b.resolve(d)});return b.getPromise()}function a(){return i}function d(a){return m(a).then(function(a){a=c("validateSharedWorkerReference")(a);return a==null?null:a})}function e(a){return k(a)}function f(a,d){var e=c("validateSharedWorkerReference")(d);if(e==null){c("FBLogger")("comet_infra").mustfix('Failed to save worker reference for bundle "%s". Invalid reference: %s',a,JSON.stringify(d));return b("Promise").resolve()}return l(a,e)}g.SHARED_WORKER_STORAGE_KEY_BASE=h;g.getDebugState=a;g.getSharedWorkerReference=d;g.removeSharedWorkerReference=e;g.saveSharedWorkerReference=f}),98);
__d("XWebWorkerInitResourceDeliveryControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/static_resources/webworker/rsrc/",Object.freeze({shared_worker:!1}),void 0);b=a;g["default"]=b}),98);
__d("WebWorkerV2DynamicData",["XWebWorkerInitResourceDeliveryControllerRouteBuilder","cometAsyncFetch","err"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function a(a){return i(a,!0)}function i(a,b){b===void 0&&(b=!1);var d=h.get(a);if(d!=null)return d;d=c("cometAsyncFetch")(c("XWebWorkerInitResourceDeliveryControllerRouteBuilder").buildUri({worker_module:a,shared_worker:b}).toString(),{data:{},getFullPayload:!0,method:"POST",skipSRState:!0}).then(function(b){if(b!=null&&typeof b==="object"&&Object.prototype.hasOwnProperty.call(b,"hrp")&&typeof b.hrp==="object")return b;throw c("err")("Unexpected data from WorkerInitResourceDeliveryController for worker %s",a)});h.set(a,d);return d}g.readDynamicDataForSharedWorker=a;g.readDynamicDataForWorker=i}),98);
__d("XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/static_resources/sharedworker/init_script/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder",["jsRouteBuilder"],(function(a,b,c,d,e,f,g){a=c("jsRouteBuilder")("/static_resources/webworker/init_script/",Object.freeze({}),void 0);b=a;g["default"]=b}),98);
__d("SharedWorkerBundleResource",["Deferred","FBLogger","SharedWorkerDevChangeManager","SharedWorkerInitFalcoEvent","SharedWorkerLockManager","SharedWorkerStatusLock","SharedWorkerStorageManager","SiteData","StaticSiteData","TrustedTypesWebWorkerScriptURLPolicy","WebWorkerV2DynamicData","XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder","XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder","getWorkerInitScriptSPINParams","nullthrows","promiseDone","regeneratorRuntime","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h=c("uuidv4")(),i=null;function j(){if(i!=null)return i;var a={get type(){i=!0}};try{new SharedWorker("blob://",a)}finally{i=(a=i)!=null?a:!1;return i}}function k(a,b,d,e){c("SharedWorkerInitFalcoEvent").log(function(){return{client_id:h,bundle_name:a,client_rev:String(c("SiteData").client_revision),local_shared_worker_ref:b!=null?{bundle_url:b.url,rev:String(b.rev),spin_time:String(b.spin_time)}:null,new_shared_worker_ref:d!=null?{bundle_url:d}:null,init_step:e}})}function l(){return c("uuidv4")()}function m(){var a;return c("nullthrows")((a=c("XCometFBMultiSiteSharedWorkerStaticInitScriptControllerRouteBuilder").buildUri({hash:l()}).addQueryParams(c("getWorkerInitScriptSPINParams")()))==null?void 0:a.toString())}function n(){var a=j(),b=c("getWorkerInitScriptSPINParams")();b.set("hash",l());return c("nullthrows")((a=c("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder").buildUri({worker_type:a?"MODULE":"CLASSIC"}))==null?void 0:(a=a.addQueryParams(b))==null?void 0:a.toString())}function o(a){a.port.addEventListener("message",function(a){var b;if(typeof a.data==="object"&&((b=a.data)==null?void 0:b.type)==="console"&&typeof ((b=a.data)==null?void 0:b.response)==="object"&&((b=a.data)==null?void 0:b.response)!=null){var d;b=a.data.response;a=b.method;b=b.args;if(typeof a!=="string"||!["log","error","info","debug","warn"].includes(a)){c("FBLogger")("comet_infra").mustfix("Unexpected console method: %s",String(a));return}if(!Array.isArray(b)){c("FBLogger")("comet_infra").mustfix('Expected console args "%s" to be an array',JSON.stringify(b));return}(d=console)[a].apply(d,b)}})}function p(a,b,d){a=new SharedWorker(c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a),b);a.port.start();o(a);a.port.postMessage({type:"execute-worker",args:[d,!1]});return a}function q(a,b){var e=j();a=c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(a);var f;e?f=new SharedWorker(a,{name:b,type:"module"}):f=new SharedWorker(a,b);f.port.start();o(f);c("promiseDone")(d("WebWorkerV2DynamicData").readDynamicDataForSharedWorker(b).then(function(a){f.port.postMessage({type:"ww-hrp-init",hrp:a.hrp,is_dev:!1})}));f.port.postMessage({type:"execute-worker",args:[{}]});return f}function r(a,b,e,f,g){a.port.addEventListener("message",function(a){var h;if(typeof a.data==="object"&&((h=a.data)==null?void 0:h.type)==="sw-get-rev"&&typeof a.data.response==="object"){h=(h=a.data)==null?void 0:(h=h.response)==null?void 0:h.workerRevision;a=(a=a.data)==null?void 0:(a=a.response)==null?void 0:a.spinTime;if(h==null||typeof h!=="number"){c("FBLogger")("comet_infra").mustfix("Expected worker rev to be non-null number, but instead received: %s",String(h));return}if(a==null||typeof a!=="number"){c("FBLogger")("comet_infra").mustfix("Expected worker spin time to be non-null number, but instead received: %s",String(a));return}c("promiseDone")(d("SharedWorkerStorageManager").saveSharedWorkerReference(e,{url:b,rev:h,spin_time:a,version:g.version}).then(function(){return d("SharedWorkerStorageManager").getSharedWorkerReference(e)}).then(function(a){k(e,a,g.resourceUrlForLogging,"after_worker_reference_save")}),function(){return f()},function(a){c("FBLogger")("comet_infra").catching(a).mustfix("Error occured during checking in shared worker reference"),f()})}}),a.port.postMessage({type:"sw-get-rev",args:[]})}function s(a,b,c){a.port.addEventListener("message",function(a){var c;typeof a.data==="object"&&((c=a.data)==null?void 0:c.type)==="sw-shutdown"&&typeof a.data.response==="object"&&((c=a.data.response)==null?void 0:c.reason)==="requested-upgrade"&&(b==null?void 0:b())});d("SharedWorkerDevChangeManager").trackCreatedWorker(c);k(c,null,null,"create_worker_end");return a}function t(a,b,c,d,e){k(a,null,null,"using_existing_worker_ref");var f;b.version===2?f=q(b.url,a):f=p(b.url,a,c.getResourceForExistingWorkerV1Init());d();return s(f,e,a)}function u(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(self.navigator.locks instanceof self.LockManager){e.next=2;break}return e.abrupt("return",!0);case 2:e.next=4;return b("regeneratorRuntime").awrap(self.navigator.locks.query());case 4:c=e.sent;return e.abrupt("return",c.held.some(function(b){return b.name===d("SharedWorkerStatusLock").getStatusLockName(a)}));case 6:case"end":return e.stop()}},null,this)}function v(a,c,e,f,g){k(a,null,null,"upgrading_worker_ref");return d("SharedWorkerStorageManager").removeSharedWorkerReference(a).then(function(){var d,h,i,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:l.next=2;return b("regeneratorRuntime").awrap(u(a));case 2:if(!l.sent){l.next=5;break}c.version===2&&j()?d=new SharedWorker(c.url,{name:a,type:"module"}):d=new SharedWorker(c.url,a);d.port.postMessage({type:"sw-shutdown",args:[{upgrade:!0}]});case 5:h=e.createSharedWorker(),i=h[0],k=h[1];r(k,i,a,f,e);return l.abrupt("return",s(k,g,a));case 8:case"end":return l.stop()}},null,this)})}function w(a,b,c,d){k(a,null,null,"new_worker_ref");var e=b.createSharedWorker(),f=e[0];e=e[1];r(e,f,a,c,b);return s(e,d,a)}function x(a,b,e,f){var g=(a=a)!=null?a:b.name;return d("SharedWorkerStorageManager").getSharedWorkerReference(g).then(function(a){k(g,a,b.resourceUrlForLogging,"create_worker_start");if(a!=null){var h;if(a.rev>=c("SiteData").client_revision&&(b.version===((h=a.version)!=null?h:1)||a.spin_time>=c("SiteData")[c("StaticSiteData").spin_time_key])&&d("SharedWorkerDevChangeManager").shouldUseCurrentWorkerIfDev(g))return t(g,a,b,e,f);else return v(g,a,b,e,f)}else return w(g,b,e,f)})}function y(a,b,e){var f=new(c("Deferred"))();d("SharedWorkerLockManager").withWorkerLock(function(d){c("promiseDone")(x(e,{name:a.name,version:1,resourceUrlForLogging:a.url,getResourceForExistingWorkerV1Init:function(){return a},createSharedWorker:function(){var b,c=m();b=(b=e)!=null?b:a.name;return[c,p(c,b,a)]}},d,b),function(a){return f.resolve(a)},function(a){return f.reject(a)})});return f.getPromise()}function z(a,b,e){var f=new(c("Deferred"))();d("SharedWorkerLockManager").withWorkerLock(function(d){c("promiseDone")(x(e,{name:a.name,version:2,resourceUrlForLogging:"",getResourceForExistingWorkerV1Init:function(){return a},createSharedWorker:function(){var b,c=n();b=(b=e)!=null?b:a.name;return[c,q(c,b)]}},d,b),function(a){return f.resolve(a)},function(a){return f.reject(a)})});return f.getPromise()}function a(a,e,f){var g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(y(a,null,e));case 2:g=h.sent,d("SharedWorkerLockManager").withWorkerLock(function(b){var h;c("promiseDone")(d("SharedWorkerStorageManager").removeSharedWorkerReference((h=e)!=null?h:a.name),function(){b(),g.port.postMessage({type:"sw-shutdown",args:f!=null?[{reason:f}]:[]})})});case 4:case"end":return h.stop()}},null,this)}function e(a,e,f){var g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(z(a,null,e));case 2:g=h.sent,d("SharedWorkerLockManager").withWorkerLock(function(b){var h;c("promiseDone")(d("SharedWorkerStorageManager").removeSharedWorkerReference((h=e)!=null?h:a.name),function(){b(),g.port.postMessage({type:"sw-shutdown",args:f!=null?[{reason:f}]:[]})})});case 4:case"end":return h.stop()}},null,this)}function f(a){var c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:e.next=2;return b("regeneratorRuntime").awrap(d("SharedWorkerStorageManager").getSharedWorkerReference(a.name));case 2:c=e.sent;return e.abrupt("return",c!=null);case 4:case"end":return e.stop()}},null,this)}g.createPushSafeSharedWebWorkerAsync=y;g.createPushSafeSharedWebWorkerV2Async=z;g.terminateSharedWorker=a;g.terminateSharedWorkerV2=e;g.doesSharedWorkerReferenceExist=f}),98);
__d("WebWorkerV2Resource",["TrustedTypesWebWorkerScriptURLPolicy","WebWorkerV2DynamicData","XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder","getWorkerInitScriptSPINParams","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h=null;function i(){if(h!=null)return h;var a={get type(){h=!0}};try{new Worker("blob://",a)}finally{h=(a=h)!=null?a:!1;return h}}function a(a,b){b=(b=b)!=null?b:a.name;a=i()?"module":"classic";var e=c("nullthrows")(c("XCometFBMultiSiteWebWorkerV2InitScriptControllerRouteBuilder").buildUri({worker_type:i()?"MODULE":"CLASSIC"}).addQueryParams(c("getWorkerInitScriptSPINParams")())).toString(),f=new Worker(c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(e),{name:b,type:a});c("promiseDone")(d("WebWorkerV2DynamicData").readDynamicDataForWorker(b).then(function(a){f.postMessage({type:"ww-hrp-init",hrp:a.hrp,is_dev:!1})}));return f}g.createDedicatedV2WebWorker=a}),98);
__d("WorkerBundleResource",["TrustedTypesWebWorkerScriptURLPolicy","XCometFBMultiSiteWebWorkerInitScriptControllerRouteBuilder","getWorkerInitScriptSPINParams","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){var d,e,f;for(var g=arguments.length,h=new Array(g>2?g-2:0),i=2;i<g;i++)h[i-2]=arguments[i];var j=(d=b==null?void 0:b.logImportScriptsErrors)!=null?d:!1,k=(e=b==null?void 0:b.name)!=null?e:a.name,l=new window.URL(a.url,window.location.href).href;if(l==null){var m=new Error("Can't start up worker without a resource url.");m.stack;throw m}var n=c("nullthrows")((f=c("XCometFBMultiSiteWebWorkerInitScriptControllerRouteBuilder").buildUri({}).addQueryParams(c("getWorkerInitScriptSPINParams")()))==null?void 0:f.toString()),o=new Worker(c("TrustedTypesWebWorkerScriptURLPolicy").createScriptURL(n),{name:k});o.postMessage({bundleUrl:l,initArgs:h,isDev:!1,resource:a,logImportScriptsErrors:j,type:"sr-init"});return o}g.createDedicatedWebWorker=a}),98);
__d("MAWWebWorkerSingleton",["FBLogger","MAWInit","MAWWebWorkerInstance","Promise","SharedWorkerBundleResource","WAResolvable","WebWorkerV2Resource","WorkerBundleResource","cr:6600","gkx","promiseDone","qex","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";var h=d("MAWWebWorkerInstance").destroyWorkerInstance,i=new(d("WAResolvable").Resolvable)();function j(a,b){c("FBLogger")("messenger_e2ee_web").mustfix("[MAWWebWorkerSingletonAsync Script Import Error: "+a+"]: %s:%s:%s:%s",JSON.stringify(b==null?void 0:b.message),b==null?void 0:b.lineno,b==null?void 0:b.colno,b==null?void 0:b.filename),d("MAWInit").MAWInit.fail("import_scripts_failure")}function k(a,b){var d;d=(d=b==null?void 0:b.message)!=null?d:"";if(d.indexOf("Failed to execute 'importScripts'")>=0){j(a,b);return}c("FBLogger")("messenger_e2ee_web").mustfix("[MAWWebWorkerSingletonAsync: "+a+"]: %s:%s:%s:%s",JSON.stringify(b==null?void 0:b.message),b==null?void 0:b.lineno,b==null?void 0:b.colno,b==null?void 0:b.filename)}function a(){var a=d("MAWWebWorkerInstance").getWorkerInstancePromise();if(!a){var e=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();l();if(e){e=c("qex")._("454")?d("SharedWorkerBundleResource").createPushSafeSharedWebWorkerV2Async:d("SharedWorkerBundleResource").createPushSafeSharedWebWorkerAsync;a=e(b("cr:6600"),function(){c("promiseDone")(i.promise.then(function(){return h()}))}).then(function(a){a.onerror=function(a){return k("Shared Worker",a)};return a.port})}else{var f=c("gkx")("4695");a=b("Promise").resolve(c("qex")._("454")?d("WebWorkerV2Resource").createDedicatedV2WebWorker(b("cr:6600")):d("WorkerBundleResource").createDedicatedWebWorker(b("cr:6600"),{logImportScriptsErrors:f})).then(function(a){a.onerror=function(a){return k("Dedicated Worker",a)};if(f){var b=function b(d){d=d==null?void 0:d.data;if(typeof d==="object")if((d==null?void 0:d.type)==="importScripts_error"){a.removeEventListener("message",b);var e=c("FBLogger")("messenger_e2ee_web");if((d==null?void 0:d.stack)!=null){var f;e=e.addMetadata("FBLOGGER","ERROR_STACK",(f=typeof (d==null?void 0:d.stack)==="string"?d==null?void 0:d.stack:JSON.stringify(d==null?void 0:d.stack))!=null?f:"no_stack")}f=(f=d==null?void 0:d.perfEntry)!=null?f:{};var g=f.duration,h=f.encodedBodySize,i=f.responseStatus;f=f.transferSize;e.mustfix("[MAWWebWorkerSingletonAsync Script Import Error Details]: %s:%s || respStatus:%s || encBodySize:%s || duration:%s || transferSize:%s",(d==null?void 0:d.source)!=null&&JSON.stringify(d==null?void 0:d.source)||"no_source",(d==null?void 0:d.error_msg)!=null&&JSON.stringify(d==null?void 0:d.error_msg)||"no_msg",(e=JSON.stringify(i))!=null?e:"none",(i=JSON.stringify(h))!=null?i:"none",(e=JSON.stringify(g))!=null?e:"none",(h=JSON.stringify(f))!=null?h:"none")}else(d==null?void 0:d.type)==="importScripts_success"&&a.removeEventListener("message",b)};a.addEventListener("message",b)}return a})}}d("MAWWebWorkerInstance").setWorkerInstancePromise(a);return a}function e(a){h=a,i.resolve()}function l(){}g.createWorkerIfNone=a;g.setOnCloseForWorkerInstance=e}),98);
__d("MessengerIntent",["WebStorage","gkx","justknobx"],(function(a,b,c,d,e,f,g){"use strict";var h="mw_sent_message",i="mw_worker_ready";function j(){return c("justknobx")._("1041")}function a(){if(!c("gkx")("8954"))return;c("WebStorage").setItemGuarded(c("WebStorage").getLocalStorage(),i,String(Date.now()))}function b(){if(!c("gkx")("8954"))return!1;var a=c("WebStorage").getLocalStorage();return Date.now()-Number(a==null?void 0:a.getItem(i))<j()}function d(){if(!c("gkx")("8954"))return;c("WebStorage").setItemGuarded(c("WebStorage").getLocalStorage(),h,String(Date.now()))}function e(){if(!c("gkx")("8954"))return!1;var a=c("WebStorage").getLocalStorage();return Date.now()-Number(a==null?void 0:a.getItem(h))<j()}g.markWorkerReady=a;g.isMAWWorkerFresh=b;g.sentMessage=d;g.hasSentMessagesRecently=e}),98);
__d("MAWSetupWorker",["CurrentUser","Deferred","IGDWebUtils","MAWClientConsistencyRefresh","MAWCommonSetupWorker","MAWCrossWorkerPortal","MAWInit","MAWWebWorkerInstance","MAWWebWorkerSingleton","MessengerIntent","Promise","SharedWorkerBundleResource","WALogger","asyncToGeneratorRuntime","cr:6600","err","gkx","promiseDone","qex","setTimeout","shouldUseMAWSharedWorker","startMAWWorkerWatchdog"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker terminating: for ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker doesn't exist, no need to terminate"]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker setting up"]);j=function(){return a};return a}var k=d("IGDWebUtils").isInstagramWebSupportedApp(Number(c("CurrentUser").getAppID())),l=k?"IGDAWMainWorker":"MAWMainWorker",m=null,n=null,o=!1;function p(e,f,g){if(o)throw c("err")("Worker is permanently killed.");var h=function(){return p(e,f,g)};d("MAWInit").MAWInit.logPoint("create_worker_start");d("MAWWebWorkerSingleton").setOnCloseForWorkerInstance(function(){s("createWorkerIfNone:onClose"),d("MAWInit").MAWInit.addBoolAnnotation("workerUpgraded",!0),c("promiseDone")(h())});d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()||c("promiseDone")(b("asyncToGeneratorRuntime").asyncToGenerator(function*(){if(!(yield q()))return;yield w()})());d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();var i=d("MAWWebWorkerSingleton").createWorkerIfNone(),k=new(c("Deferred"))();m=k.getPromise();a=i;return a.then(function(a){d("MAWInit").MAWInit.logPoint("create_worker_end");if(a===null)throw c("err")("Client is starting bridge without a worker.");d("WALogger").LOG(j());d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&a.addEventListener("message",function(a){var b;typeof a.data==="object"&&((b=a.data)==null?void 0:b.type)==="sw-shutdown"&&typeof a.data.response==="object"&&((b=a.data.response)==null?void 0:b.reason)==="maw-request-refresh"&&(n==null?void 0:n(),c("MAWClientConsistencyRefresh")("worker_mismatch"))});d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();var i=new(d("MAWCommonSetupWorker").BridgeAdapter)(a,l);k.resolve(i);g(i);return d("MAWInit").MAWInit.measurePerformance("maw_init_worker",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=function(){return d("MAWCommonSetupWorker").initWorker(i,e,f,h)},b;!d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker()&&(c("qex")._("454")||c("gkx")("5659"))?b=(yield i.fullyConnected.then(a)):b=(yield a());d("MessengerIntent").markWorkerReady();return b}))})}function e(a,b,d){if(!m){var e=p(a,b,d);n=c("startMAWWorkerWatchdog")(a,b,d);return e}return m}function q(){return d("SharedWorkerBundleResource").doesSharedWorkerReferenceExist(b("cr:6600"))}function r(a,b,e){if(!m){b&&d("WALogger").LOG(i());return!1}b&&d("WALogger").LOG(h(),e);c("promiseDone")(m.then(function(a){return a==null?void 0:a.close()}));m=null;d("MAWCrossWorkerPortal").killPortalWhenWorkerTerminating();d("MAWWebWorkerInstance").destroyWorkerInstance();a&&n!=null&&(n(),n=null);return!0}function s(a){r(!0,!0,a)}function f(){r(!0,!0,"terminateWorkerPermanently"),o=!0}function t(){return u.apply(this,arguments)}function u(){u=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){r(!1,!1,"killWorkerForTest")&&(yield v(45e3))});return u.apply(this,arguments)}function v(a){return new(b("Promise"))(function(b){return c("setTimeout")(b,a)})}function w(a){return x.apply(this,arguments)}function x(){x=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){a===void 0&&(a=!0);var e=c("qex")._("454")?d("SharedWorkerBundleResource").terminateSharedWorker:d("SharedWorkerBundleResource").terminateSharedWorkerV2;yield e(b("cr:6600"),null,a?"maw-request-refresh":void 0)});return x.apply(this,arguments)}function y(a){return z.apply(this,arguments)}function z(){z=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){var b=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();b?yield w(!1):s(a)});return z.apply(this,arguments)}g.getOrSetupWorker=e;g.isSharedWorkerActive=q;g.terminateWorker=s;g.terminateWorkerPermanently=f;g.killWorkerForTest=t;g.killSharedWorker=w;g.killSharedWorkerOrTerminateWebWorkerTmp=y}),98);
__d("MAWSharedWorkerReboot",["MAWSetupWorker","ODS","WALogger","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Clear the shared worker reference in MAWSharedWorkerReboot"]);h=function(){return a};return a}function a(a,b,e){d("ODS").bumpEntityKey(3185,"armadillo_shared_worker_reboot","start_reboot_shared_worker");var f=function(){return d("MAWSetupWorker").getOrSetupWorker(a,b,e)};d("WALogger").LOG(h());d("MAWSetupWorker").terminateWorker("Clear the shared worker reference in MAWSharedWorkerReboot");c("promiseDone")(f(),e)}g.rebootSharedWorker=a}),98);
__d("startMAWWorkerWatchdog",["CurrentUser","MAWBridgeSendAndReceive","MAWIssueNewUserVisibleErrors","MAWSharedWorkerReboot","ODS","Promise","WALogger","clearInterval","err","promiseDone","setInterval","setTimeout","shouldUseMAWSharedWorker"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["shared worker reconnection failed"]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["starting reconnection to shared worker"]);i=function(){return a};return a}var j=20*1e3,k=j/2,l=!1;function a(a,e,f){var g=c("setInterval")(function(){var j=new(b("Promise"))(function(a,b){c("setTimeout")(function(){b(c("err")("Armadillo web worker heartbeat timed out. "))},k)});j=b("Promise").race([d("MAWBridgeSendAndReceive").sendAndReceive("backend","getWorkerHeartbeat"),j]);c("promiseDone")(j.then(function(a){a||(d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER),c("clearInterval")(g)),l&&d("ODS").bumpEntityKey(3185,"armadillo_worker_watch_dog","reboot_shared_worker_successfully"),l=!1})["catch"](function(b){d("ODS").bumpEntityKey(3185,"armadillo_worker_watch_dog","worker_is_not_responding");var j=d("shouldUseMAWSharedWorker").shouldUseMAWSharedWorker();d("shouldUseMAWSharedWorker").logExposureForMAWSharedWorker();if(j&&!l&&c("CurrentUser").isLoggedInNow())d("WALogger").LOG(i()),d("ODS").bumpEntityKey(3185,"armadillo_worker_watch_dog","reboot_shared_worker_start"),l=!0,d("MAWSharedWorkerReboot").rebootSharedWorker(a,e,f);else{l&&(d("WALogger").ERROR(h()),d("ODS").bumpEntityKey(3185,"armadillo_worker_watch_dog","reboot_shared_worker_failed"));d("MAWIssueNewUserVisibleErrors").issueError(d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgBody,d("MAWIssueNewUserVisibleErrors").MAWGeneralErrorMsgTitle,d("MAWIssueNewUserVisibleErrors").MAWUserVisibleErrorPresentationType.BANNER);c("clearInterval")(g);throw b}}))},j);return function(){c("clearInterval")(g)}}g["default"]=a}),98);
__d("WADevToolMessageChannel",[],(function(a,b,c,d,e,f){var g=new MessageChannel();a=function(){g=new MessageChannel();return g};b=function(){return g};f.createNewChannel=a;f.getMostRecentChannel=b}),66);
__d("FuncChannel",["FBLogger","Promise"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var d=this,e;this.$2=[];this.callMessageHandler=function(a){return new(b("Promise"))(function(b,c){a.result={resolveFunc:b,rejectFunc:c},d.$2.push(a)})};this.messageToCall=function(a){var b,e,f=d.proxyMethods[a.method];if(typeof f!=="function"){c("FBLogger")("worker").mustfix("proxyMethods[%s] is not a functions",a.method);return}b=(b=a.result)==null?void 0:b.resolveFunc;e=(e=a.result)==null?void 0:e.rejectFunc;if(typeof b==="function"&&typeof e==="function")try{var g=f.apply(a.thisArg,a.argList);b(g)}catch(a){e(a)}else return f.apply(a.thisArg,a.argList)};var f=this,g={},h=(e=a==null?void 0:a(g))!=null?e:{},i=babelHelpers["extends"]({},g);function j(a){i[a]=function(){var b={type:"call",method:a,thisArg:null,argList:Array.from(arguments)};return f.callMessageHandler(b)},g[a]=function(){var b=f.$1[a];if(typeof b!=="function"){c("FBLogger")("worker").mustfix("_backend[%s] is not a functions",a);return}return b.apply(f.$1,arguments)},h[a]==null&&(h[a]=g[a])}this.$1=i;if(a!=null){e=Object.keys(h);e.forEach(j);this.proxyMethods=h}else this.proxyMethods=new Proxy(h,{get:function(a,b){a=b;h[a]==null&&j(a);return h[a]}})}var d=a.prototype;d.flushBuffer=function(){var a=this.$2;this.$2=[];a.forEach(this.messageToCall)};d.setBackend=function(a){this.$1!==a&&(this.$1=a,this.flushBuffer());return this};d.setCallMessageHandler=function(a){this.callMessageHandler=a,this.flushBuffer()};return a}();g["default"]=a}),98);
__d("MainPageUrl",["ExecutionEnvironment","FBLogger","SimpleHook"],(function(a,b,c,d,e,f,g){"use strict";var h=new URL("http://undefined"),i=new(d("SimpleHook").SimpleHook)();function j(){var a;return c("ExecutionEnvironment").isInBrowser&&(h==null?void 0:(a=h.searchParams)==null?void 0:a.get("workerlog"))==="debug"}function a(a){try{j()&&c("FBLogger")("worker").debug("received url "+a);var b=new URL(a,h.href||"http://undefined");h.href!==b.href?(h.href=b.href,i.call(h)):j()&&c("FBLogger")("worker").debug("ignoring url: path didn't change in "+a)}catch(a){c("FBLogger")("worker").catching(a).warn("invalid url")}}typeof window==="object"&&typeof window.location==="object"&&typeof window.location.href==="string"&&a(window.location.href);g.mainPageUrl=h;g.onMainPageUrlChange=i;g.isWorkerLogEnabled=j;g.updateMainPageUrl=a}),98);
__d("TimedOnceFunc",["ExecutionEnvironment"],(function(a,b,c,d,e,f,g){a=function(){function a(a,b){this.$2=!1,this.$4=a,this.$3=b,c("ExecutionEnvironment").isInBrowser&&this.$5()}var b=a.prototype;b.$6=function(){this.$1!=null&&clearTimeout(this.$1),this.$1=null};b.$5=function(){var a=this;this.isDone()||(this.$6(),this.$1=setTimeout(function(){a.$2=!0,a.run()},this.$3))};b.isDone=function(){return this.$4===null};b.isCancelled=function(){return this.$1===null&&this.$4!==null};b.run=function(){this.$6();if(this.$4!=null){var a=this.$4;this.$4=null;a(this.$2)}};b.getDelay=function(){return this.$3};b.delay=function(a){this.$3=(a=a)!=null?a:this.$3;this.$5()};b.cancel=function(){this.$6()};return a}();g.TimedOnceFunc=a}),98);
__d("VirtualMessageChannel",["invariant","Promise","SimpleHook","nullthrows","promiseDone"],(function(a,b,c,d,e,f,g,h){"use strict";var i=function(){function a(a){a===void 0&&(a=!1),this.$2=new(d("SimpleHook").SimpleHook)(),this.onmessage=null,this.onmessageerror=null,this.$3=a}var e=a.prototype;e.setRemotePort=function(a){this.$1=a};e.addEventListener=function(a,b,c){(a==="message"||a==="error")&&c==null||h(0,55320,a);if(a==="message")if(typeof b==="function")this.$2.add(b);else{c=b.handleEvent.bind(b);this.$2.add(c);b.__handler=c}};e.removeEventListener=function(a,b,c){if(typeof b==="function")this.$2.remove(b);else{a=b.__handler;this.$2.remove(a)}};e.postMessage=function(a,d){var e=this,f=function(){var b=c("nullthrows")(e.$1,"By now remote port must have value!");b.$2.call({data:a,ports:d})};this.$3?f():c("promiseDone")(b("Promise").resolve(),f)};e.start=function(){};return a}();a=function(a,b){this.port1=new i(a),this.port2=new i(b),this.port1.setRemotePort(this.port2),this.port2.setRemotePort(this.port1)};g.VirtualMessagePort=i;g.VirtualMessageChannel=a}),98);
__d("DoubleKeyMap",[],(function(a,b,c,d,e,f){"use strict";a=function(){function a(){this.$1=new Map()}var b=a.prototype;b.set=function(a,b,c){var d=this.$1.get(a);d||this.$1.set(a,d=new Map());d.set(b,c)};b.get=function(a,b){return(a=this.$1.get(a))==null?void 0:a.get(b)};b["delete"]=function(a,b){var c=this.$1.get(a);c&&(c["delete"](b),c.size===0&&this.$1["delete"](a))};b.getAll=function(a){return this.$1.get(a)};b.deleteAll=function(a){this.$1["delete"](a)};return a}();f.DoubleKeyMap=a}),66);
__d("NestedTimeRange",["SimpleHook","performance","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("SimpleHook").SimpleHook)(),i=new(d("SimpleHook").SimpleHook)(),j="/";function k(a,b){return""+a+j+b}b=function(){function a(a,b){b===void 0&&(b=null),this.$3=0,this.$1=a,this.$2=b}var b=a.prototype;b.isRunning=function(){return this.$3>0};b.fullname=function(){return this.$2!==null?k(this.$2.fullname(),this.$1):this.$1};b.start=function(a){a===void 0&&(a=c("performanceAbsoluteNow")());if(this.$3===0){var b;(b=this.$2)==null?void 0:b.start(a);this.__onStart(a)}++this.$3;return a};b.__onStart=function(a){h.call(this,a)};b.stop=function(a){a===void 0&&(a=c("performanceAbsoluteNow")());--this.$3;if(this.$3===0){var b;this.__onStop(a);(b=this.$2)==null?void 0:b.stop(a)}return a};b.__onStop=function(a){i.call(this,a)};return a}();function a(){c("performance").mark&&c("performance").measure&&(h.add(function(a,b){c("performance").mark(a.fullname()+"_start")}),i.add(function(a,b){c("performance").measure(a.fullname(),a.fullname()+"_start")}))}g.OnRangeStart=h;g.OnRangeStop=i;g.TIME_RANGE_LEVEL_SEPARATOR=j;g.rangeFullName=k;g.NestedTimeRange=b;g.enableDevConsoleTimeline=a}),98);
__d("QLogEvent",["DoubleKeyMap","FBLogger","NestedTimeRange","QPLEvent","SimpleHook","performanceNavigationStart"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("DoubleKeyMap").DoubleKeyMap)(),i=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,d){a=b.call(this,a,d)||this;a.$QPLRange1=c;h.set(c,a.fullname(),babelHelpers.assertThisInitialized(a));return a}var e=a.prototype;e.__onStart=function(a){b.prototype.__onStart.call(this,a),this.$QPLRange1.point(this.fullname()+"_START",{timestamp:a})};e.__onStop=function(a){b.prototype.__onStop.call(this,a),this.$QPLRange1.point(this.fullname()+"_END",{timestamp:a}),h["delete"](this.$QPLRange1,this.fullname())};e.range=function(b){this.fullname().startsWith(d("NestedTimeRange").TIME_RANGE_LEVEL_SEPARATOR)||c("FBLogger")("qpl").warn("Range %s cannot have subrange since root name does not start with /",this.fullname());var e=d("NestedTimeRange").rangeFullName(this.fullname(),b);return(e=h.get(this.$QPLRange1,e))!=null?e:new a(b,this.$QPLRange1,this)};return a}(d("NestedTimeRange").NestedTimeRange),j=new(d("DoubleKeyMap").DoubleKeyMap)(),k=new(d("SimpleHook").SimpleHook)(),l=new(d("SimpleHook").SimpleHook)(),m=new(d("SimpleHook").SimpleHook)(),n=new(d("SimpleHook").SimpleHook)(),o=function(b){babelHelpers.inheritsLoose(a,b);function a(a,c,e,f){var g;c===void 0&&(c=0);e===void 0&&(e=2);f===void 0&&(f=!1);var h=d("QPLEvent").getMarkerId(a);g=b.call(this,"event_"+h)||this;g.event=a;g.instanceKey=c;g.$QPLEvent1=e;g.isUserFlow=f;j.set(h,c,babelHelpers.assertThisInitialized(g));return g}var e=a.prototype;e.action=function(a){this.$QPLEvent1=a;return this};e.getAction=function(){return this.$QPLEvent1};e.setIsUserFlow=function(a){this.isUserFlow=a;return this};e.startFromNavStart=function(){this.start(c("performanceNavigationStart")());return this};e.startFromTime=function(a){this.start(a);return this};e.__onStart=function(a){k.call(this,a)};e.__onStop=function(a){l.call(this,a),h.deleteAll(this),j["delete"](d("QPLEvent").getMarkerId(this.event),this.instanceKey)};e.range=function(a){var b;return(b=h.get(this,a))!=null?b:new i(a,this)};e.point=function(a,b){b===void 0&&(b={});m.call(this,a,b);return this};e.annotate=function(a){n.call(this,a);return this};return a}(d("NestedTimeRange").NestedTimeRange);function a(a,b){var c;b===void 0&&(b=0);return(c=j.get(d("QPLEvent").getMarkerId(a),b))!=null?c:new o(a,b)}g.OnEventStart=k;g.OnEventStop=l;g.OnEventPoint=m;g.OnEventAnnotate=n;g.QPLEvent=o;g.event=a}),98);
__d("WorkerMessagePort",["FBLogger","MainPageUrl","Promise","PromiseAnnotate","QLogEvent","SimpleHook","VirtualMessageChannel","performanceAbsoluteNow","promiseDone","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=20,i=100,j=50;function k(a){return a}var l=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(d("SimpleHook").SimpleHook);function m(a,b){a=k(a);a.__timing=b}function n(a){return a.__timing}var o=0;function p(){return d("QLogEvent").event(c("qpl")._(41497718,"106"),o++)}var q=Math.random()<.1;function r(a,b,c){var d;if(b==null||!q)return;var e=b.sendDelayHighPrecision,f=b.sendTimestamp,g=b.sendDateTime,j=b.receiveTimestamp;b=b.receiveDateTime;d=(d=c)!=null?d:p();c==null&&d.startFromTime();var k=d.range("SEND_DELAY");k.start(f);k.stop(j);k=d.range("SEND_DELAY_LOW_PRECISION");k.start(g);k.stop(b);k=Math.abs(f-g);f=Math.abs(j-b);d.annotate({string:{port_name:a},"int":{send_delay:e,send_drift:k,receive_drift:f},bool:{send_delay_above_max:e!=null&&e>h,send_drift_above_max:k>i,receive_drift_above_max:f>i}});c==null&&d.stop()}a=function(){var a=e.prototype;a.onMessageHandler=function(a){try{this.onMessage.call(a);var b=this.$1[a.type];!b?this.onUnhandledMessage.call(a):b.call(a)}catch(a){this.onError.call(a)}};function e(a,b){var d=this;this.$1={};this.onUnhandledMessage=new l();this.onMessage=new l();this.onPostMessage=new l();this.onError=new l();this.$2=a;this.name=b;this.$2.addEventListener("message",function(a){return d.onMessageHandler(k(a.data))});this.$2.addEventListener("error",function(a){return d.onError.call(a)});this.onPostMessage.add(function(a){m(a,{sendTimestamp:c("performanceAbsoluteNow")(),receiveTimestamp:-1,sendDelayHighPrecision:0,sendDateTime:Date.now(),receiveDateTime:-1,sendDelayLowPrecision:0})});this.onMessage.add(function(a){a=n(a);if(a!=null){var b=a.sendTimestamp,e=a.sendDateTime,f=c("performanceAbsoluteNow")(),g=Date.now();a.receiveTimestamp=f;a.receiveDateTime=g;a.sendDelayHighPrecision=f-b;a.sendDelayLowPrecision=g-e;r(d.name,a)}})}a.postMessage=function(a,b){this.onPostMessage.call(a),b?this.$2.postMessage(a,b):this.$2.postMessage(a)};a.addMessageListener=function(a,b){var c=this.$1[a];c||(c=new l(),this.$1[a]=c);return c.add(b)};a.removeMessageListener=function(a,b){a=this.$1[a];return!!a&&a.remove(b)};a.onMessageOnce=function(a,c){var d=this;return new(b("Promise"))(function(b){var e=d.addMessageListener(a,function(f){c(f)&&(d.removeMessageListener(a,e),b(f))})})};a.close=function(){if(this.$2 instanceof MessagePort)this.$2.close();else if(this.$2 instanceof Worker)this.$2.terminate();else if(this.$2 instanceof DedicatedWorkerGlobalScope)this.$2.close();else{var a;(a=(a=this.$2.close)!=null?a:this.$2.terminate)==null?void 0:a.call(this.$2)}};a.isWrappingVirtualMessagePort=function(){return this.$2 instanceof d("VirtualMessageChannel").VirtualMessagePort};return e}();function s(a){return k(a)}e=function(a){babelHelpers.inheritsLoose(e,a);function e(e,f){var g;g=a.call(this,e,f)||this;var h=s(babelHelpers.assertThisInitialized(g));e=h.onMessageOnce("endpoint_started",function(){return!0});f=h.onMessageOnce("endpoint_started_received",function(){return!0});void d("PromiseAnnotate").setDisplayName(e,"endpoint_started");void d("PromiseAnnotate").setDisplayName(f,"endpoint_started_received");h.postMessage({type:"endpoint_started",endpoint:g.name});c("promiseDone")(e,function(a){var b=n(a);h.postMessage({type:"endpoint_started_received",endpoint:a.endpoint,targetEndpoint:g.name,startSendTimestamp:b==null?void 0:b.sendTimestamp});r(g.name,b)});c("promiseDone")(f,function(a){var b=n(a);if(b!=null){var c=p();c.startFromTime();r(g.name,b,c);var d=c.range("ROUND_TRIP");d.start(a.startSendTimestamp);d.stop(b.receiveTimestamp);d=b.receiveTimestamp-a.startSendTimestamp;c.annotate({"int":{round_trip:d},bool:{round_trip_above_max:d>j}}).stop()}});g.fullyConnected=b("Promise").race([e,f]).then(function(){return babelHelpers.assertThisInitialized(g)});return g}return e}(a);g.getMessageTiming=n;g.WorkerMessagePort=a;g.CastWorkerMessagePort=s;g.WorkerSyncedMessagePort=e}),98);
__d("WorkerFuncChannel",["invariant","DateConsts","ExecutionEnvironment","FBLogger","FuncChannel","MainPageUrl","Promise","TimedOnceFunc","VirtualMessageChannel","WorkerMessagePort","err","promiseDone"],(function(a,b,c,d,e,f,g,h){"use strict";var i={serialize:function(a,b){b.push(a);return a},deserialize:function(a){return a}},j=1e4,k=0,l=5,m=l+1,n=function(){function a(a){var b=self.WeakRef;b&&(this.$1=new b(a))}var b=a.prototype;b.isDead=function(){return this.$1!=null&&this.$1.deref()==null};return a}(),o=function(e){babelHelpers.inheritsLoose(a,e);function a(a,b,f,g){var i;f===void 0&&(f=null);g===void 0&&(g={});i=e.call(this,a)||this;i.$WorkerFuncChannel1=new Map();i.$WorkerFuncChannel2=new Map();i.$WorkerFuncChannel5={"function":{serialize:function(a,b){b=m++;i.$WorkerFuncChannel1.set(b,a);a={type:"function",value:b};return a},deserialize:function(a){var b=babelHelpers.assertThisInitialized(i),c=a.value;a=function(){var a={type:"call",id:c,method:"__anonymous",thisArg:null,argList:Array.from(arguments)};return b.callMessageHandler(a)};i.$WorkerFuncChannel2.set(c,new n(a));return a}},custom:{serialize:function(a,b){var c=a.constructor.name,d=i.$WorkerFuncChannel4[c];d!=null||h(0,63779,c);d=d.serialize(a,b);return{type:"custom",custom:c,value:d}},deserialize:function(a){var b=a.custom,c=i.$WorkerFuncChannel4[b];c!=null||h(0,63779,b);return c.deserialize(a.value)}},error:{serialize:function(a,b){b={name:a.name,message:a.message,stack:a.stack};return{type:"error",value:b}},deserialize:function(a){var b=c("err")(a.value.message);b.name=a.value.name;b.stack=a.value.stack;return b}},object:{serialize:function(a,b){b=a.constructor;if(b!==Object)throw new Error("Cannot clone class object");return{type:"object",value:a}},deserialize:function(a){return a.value}},raw:{serialize:function(a,b){return{type:"raw",value:a}},deserialize:function(a){return a.value}}};i.name=b;i.$WorkerFuncChannel3=f;i.$WorkerFuncChannel4=g;a=function(a){d("MainPageUrl").isWorkerLogEnabled()&&c("FBLogger")("adsworker").debug("[Channel] removing callback ids: %s",a.join()),a.forEach(function(a){return i.$WorkerFuncChannel1["delete"](a)})};var l=i.__remoteInternalFunc(k,a);typeof jest===typeof void 0&&c("ExecutionEnvironment").isInBrowser&&setInterval(function(){var a=[];i.$WorkerFuncChannel2.forEach(function(b,c){b.isDead()&&(a.push(c),i.$WorkerFuncChannel2["delete"](c))});a.length>0?l(a):i.$WorkerFuncChannel2.size>5e3&&c("FBLogger")("adsworker").warn("[%s] has too many remaining refs %s",i.name,i.$WorkerFuncChannel2.size)},j);return i}var f=a.prototype;f.__remoteInternalFunc=function(a,b){(a>l||this.$WorkerFuncChannel1.get(a)!=null)&&c("FBLogger")("adsworker").mustfix("invalid internal func id %s",a);this.$WorkerFuncChannel1.set(a,b);b=this.$WorkerFuncChannel5["function"].deserialize({type:"function",value:a});return b};f.$WorkerFuncChannel6=function(a){return a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Uint8Array||a instanceof Uint8ClampedArray||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array};f.$WorkerFuncChannel7=function(a){if(typeof a==="function")return"function";if(a===null)return"raw";if(typeof a!=="object")return"raw";if(Array.isArray(a))return"raw";if(this.$WorkerFuncChannel6(a))return"raw";var b=a.constructor.name;if(this.$WorkerFuncChannel4[b])return"custom";return a instanceof Error?"error":"object"};f.$WorkerFuncChannel8=function(a,b){var c=this.$WorkerFuncChannel7(a);return this.$WorkerFuncChannel5[c].serialize(a,b)};f.$WorkerFuncChannel9=function(a){var b=a;if(a!==null&&typeof a==="object"&&typeof a.type==="string"){var c=this.$WorkerFuncChannel5[a.type];if(c)return c.deserialize(a)}return b};f.__onPostOutMessage=function(a){return a};f.__callCallback=function(a,b){a.apply(null,b.argList)};f.setOutMessagePort=function(a,d){var e=this,f=[];this.setCallMessageHandler(function(d){d.thisArg=e.name;var g=[];d.argList=d.argList.map(function(a){return e.$WorkerFuncChannel8(a,g)});var h=new(b("Promise"))(function(a,b){d.result={resolveFunc:e.$WorkerFuncChannel8(a,g),rejectFunc:e.$WorkerFuncChannel8(b,g)}}),i=e.__onPostOutMessage(d);i!=null&&(f!=null?f.push({message:d,transferList:g}):a.postMessage(d,g));h["catch"](function(a){c("FBLogger")("worker").catching(a).mustfix("Error: channel %s, remote call of %s returned error %s",e.name,d.method,a.message)});return h});c("promiseDone")(d||v.waitForRemote(this.name),function(){var b=f;f=null;b==null?void 0:b.forEach(function(b){a.postMessage(b.message,b.transferList)});e.$WorkerFuncChannel3==null?void 0:e.$WorkerFuncChannel3()})};f.__messageToCall=function(a){var b=this;a.argList=a.argList.map(function(a){return b.$WorkerFuncChannel9(a)});if(a.result){var d=a.result,e=d.resolveFunc;d=d.rejectFunc;e=this.$WorkerFuncChannel9(e);d=this.$WorkerFuncChannel9(d);a.result={resolveFunc:e,rejectFunc:d}}e=a.id;if(e===void 0)this.messageToCall(a);else{d=this.$WorkerFuncChannel1.get(e);d?this.__callCallback(d,a):c("FBLogger")("adsworker").mustfix("Error: callback is called but no longer available")}};f.setInMessagePort=function(a){var b=this;a.addMessageListener("call",function(a){typeof a.thisArg==="string"&&a.thisArg===b.name&&b.__messageToCall(a)});v.notifyReady(this.name)};f.setMessagePort=function(a){this.setInMessagePort(a);this.setOutMessagePort(a);return this};return a}(c("FuncChannel")),p=function(b){babelHelpers.inheritsLoose(a,b);function a(){return b.apply(this,arguments)||this}return a}(d("WorkerMessagePort").WorkerMessagePort);function q(a,b,d,e){v.exportChannel(a,function(e){var f=e.syncPort;e=e.remoteNativePort;var g=b();a===g.name||h(0,54247,a,g.name);var i;e?(i=new p(e,f.name+"("+g.name+")"),e.start(),i.onError.add(function(a){c("FBLogger")("worker").catching(a).mustfix("error caught in remotePort");throw a})):i=f;g.setMessagePort(i).setBackend(d);c("promiseDone")(f.fullyConnected,function(){f.postMessage({type:"channelReady",channelName:g.name}),v.logState("EXPORTED",a)})})}function a(a,b,c,d){d===void 0&&(d={});return q(c,function(){return new o(function(b){return a},c,null,d)},a,b)}var r=function(b){babelHelpers.inheritsLoose(a,b);function a(a,e){e===void 0&&(e="");var f=d("DateConsts").MS_PER_MIN*1;return b.call(this,function(){c("FBLogger")("worker").warn("Channel %s did not establish eventually. %s",a,e)},f)||this}return a}(d("TimedOnceFunc").TimedOnceFunc);function s(a,b){var e,f=null,g,h;b.isWrappingVirtualMessagePort()?(h=new(d("VirtualMessageChannel").VirtualMessageChannel)(!0,!0),e="on virtual dedicated channel"):(h=new MessageChannel(),e="on native dedicated channel",g=[h.port2]);var i=h.port1;f=h.port2;i.start();var j=new p(i,b.name+"("+a.name+")");c("promiseDone")(b.fullyConnected,function(){v.logState("IMPORTING "+e+" ",a.name);a.setInMessagePort(j);var d=new r(a.name,e);c("promiseDone")(b.onMessageOnce("channelReady",function(b){return b.channelName===a.name}),function(b){a.setOutMessagePort(j),d.cancel(),v.logState("ESTABLISHED",a.name)});b.postMessage({type:"channelImport",channelName:a.name,port:f},g)});return a.proxyMethods}function t(a,b,c,d){c===void 0&&(c=null);d===void 0&&(d={});b=new o(function(b){return a},b,c,d);return b}function e(a,b,c,d,e){d===void 0&&(d=null);e===void 0&&(e={});return s(t(a,c,d,e),b)}var u=function(){function a(){this.name=self.name+"_P"+Math.round(10*Math.random()),this.$1=new Map(),this.$2=new Set()}var e=a.prototype;e.logState=function(a,b){d("MainPageUrl").isWorkerLogEnabled()&&c("FBLogger")("worker").debug("%s-%s %s",this.name,a,b)};e.$3=function(a){var b=this.$1.get(a);b==null&&(b={pendingPorts:null,onImportRequest:null},this.$1.set(a,b));return b};e.exportChannel=function(a,b){var d=this,e=this.$3(a);e.onImportRequest!=null&&c("FBLogger")("worker").debug("Re-exporting channel %s",a);e.onImportRequest=b;this.logState("REGISTERED",a);a=e.pendingPorts;if(a!=null){var f=a.filter(function(a){return d.$2.has(a.syncPort)});f.forEach(b);f.length<a.length?e.pendingPorts=a.filter(function(a){return!d.$2.has(a.syncPort)}):e.pendingPorts=null}return e};e.activate=function(a,b,d){var e=this;if(this.$2.has(a)){c("FBLogger")("worker").debug("Port %sis already duplicated ",a.name);return}this.$2.add(a);a.addMessageListener("channelImport",function(b){var c=b.channelName,d=e.$3(c);b={syncPort:a,remoteNativePort:b.port};d.onImportRequest!=null?d.onImportRequest(b):d.pendingPorts!=null?d.pendingPorts.push(b):d.pendingPorts=[b];e.logState("IMPORT REQUEST",c)})};e.notifyReady=function(a){};e.waitForRemote=function(a){return b("Promise").resolve()};return a}(),v=new u();function f(a,b,c){v.activate(a,b,c)}g.TransferableTransformer=i;g.WorkerFuncChannel=o;g.exportChannelOnPort=q;g.exportChannel=a;g.importChannelOnPort=s;g.makeChannel=t;g.importChannel=e;g.activateChannels=f}),98);
__d("WorkerBanzaiLazyQueueChannelClient",["BanzaiLazyQueue","WorkerFuncChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").exportChannel(c("BanzaiLazyQueue"),a,"banzai_lazyqueue_channel")}g.init=a}),98);
__d("WorkerQPLChannel",["WorkerFuncChannel","performanceAbsoluteNow"],(function(a,b,c,d,e,f,g){"use strict";var h=new(d("WorkerFuncChannel").WorkerFuncChannel)(function(a){return{markerStartFromNavStart:null,markerStart:function(b,d,e){e===void 0&&(e=c("performanceAbsoluteNow")());return a.markerStart(b,d,e)},markerAnnotate:function(b,c,d){return a.markerAnnotate(b,c,d)},markerPoint:function(b,d,e){e=(e==null?void 0:e.timestamp)===void 0?babelHelpers["extends"]({},e,{timestamp:c("performanceAbsoluteNow")()}):e;return a.markerPoint(b,d,e)},markerEnd:function(b,d,e,f){f===void 0&&(f=c("performanceAbsoluteNow")());return a.markerEnd(b,d,e,f)}}},"qpl");function a(a){h.setMessagePort(a)}function b(a){h.setBackend(a)}g.setMessagePort=a;g.initQPL=b}),98);
__d("WorkerClient",["WorkerBanzaiLazyQueueChannelClient","WorkerFuncChannel","WorkerQPLChannel"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("WorkerFuncChannel").activateChannels(a,"client","worker"),d("WorkerBanzaiLazyQueueChannelClient").init(a),d("WorkerQPLChannel").setMessagePort(a),e(["QuickPerformanceLogger"],function(a){return d("WorkerQPLChannel").initQPL(a)})}g.init=a}),98);
__d("MAWCommonSetupWorker",["Deferred","MAWCurrentUser","MAWInit","MAWMainThreadLogger","MAWSetupWorker","QuickPerformanceLogger","WADevToolMessageChannel","WALogger","WorkerClient","WorkerMessagePort","err","gkx","pageID","qpl","waitForMAWTTRC"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["Terminating worker and rebooting..."]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["worker receive invalid message: ",""]);i=function(){return a};return a}b=function(a){babelHelpers.inheritsLoose(b,a);function b(b,c){var e;e=a.call(this,b,c)||this;e.onmessage=null;e.$BridgeAdapter1=b;d("WorkerClient").init(babelHelpers.assertThisInitialized(e));e.onUnhandledMessage.add(function(a){e.onmessage&&e.onmessage({data:a})});return e}var c=b.prototype;c.getBridgePort=function(){return this};return b}(d("WorkerMessagePort").WorkerSyncedMessagePort);function a(a,b,e,f){var g=new(c("Deferred"))();a.addMessageListener("worker-setup",function(b){var e;if(b.setupHash!==c("pageID"))return;b.status==="failure"&&((e=b.logs)==null?void 0:e.length)&&d("MAWMainThreadLogger").logToHistoryInBulk(b.logs);if(b==null||b.type!=="worker-setup"){d("WALogger").WARN(i(),b);return}if(b.status==="success")g.resolve(a.getBridgePort());else if(b.status==="failure"){g.reject(c("err")((e=b.msg)!=null?e:"Encountered an error setting up the armadillo web worker"))}else if(b.status==="already-setup")if(b.action==="no-action"){g.resolve(a.getBridgePort());c("QuickPerformanceLogger").markerDrop(c("qpl")._(1056839232,"112"));d("waitForMAWTTRC").resolvable.resolve();return}else if(b.action==="reboot-required"&&b.setupHash===c("pageID")){d("WALogger").DEV(h());d("MAWSetupWorker").terminateWorker("reboot required");d("MAWInit").MAWInit.addBoolAnnotation("workerRebootRequired",!0);return f().then(function(a){return g.resolve(a)})["catch"](function(a){return g.reject(a)})}else throw c("err")("received invalid action for worker-setup:already-setup: "+b.action);else throw c("err")("received invalid message for worker")});if(c("gkx")("5147")){var j=d("WADevToolMessageChannel").createNewChannel();a.postMessage({content:{devToolMessageChannelPort2:j.port2,fbId:d("MAWCurrentUser").getID(),latestKeyVersionForEAR:b,vaultMaterials:e},setupHash:c("pageID"),type:"worker-setup"},[j.port2])}else a.postMessage({content:{fbId:d("MAWCurrentUser").getID(),latestKeyVersionForEAR:b,vaultMaterials:e},setupHash:c("pageID"),type:"worker-setup"});return g.getPromise()}g.BridgeAdapter=b;g.initWorker=a}),98);
__d("LSInitSyncCompleteSubscription",["I64","LSIntEnum","Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";function h(a,c){return new(b("Promise"))(function(b,e){var f=d("ReQL").fromTableAscending(a.table("sync_groups")).getKeyRange(c).subscribe(function(a,c){if(c.operation==="delete")return;if(d("I64").equal(c.value.syncStatus,d("LSIntEnum").ofNumber(2))){f();return b()}})})}function a(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("sync_groups")).getKeyRange(b)).then(function(c){if(c!=null&&d("I64").equal(c.syncStatus,d("LSIntEnum").ofNumber(2)))return;return h(a,b)})}function c(a){return h(a,d("LSIntEnum").ofNumber(1))}g.maybeWaitForSyncGroup=a;g.use=c}),98);
__d("LSThreadMediaGalleryGroup",[],(function(a,b,c,d,e,f){a=Object.freeze({PHOTOS_AND_VIDEOS:0,FILES_ONLY:1,LINKS:2});f["default"]=a}),66);
__d("WAChatState",[],(function(a,b,c,d,e,f){"use strict";a="typing";b="recording_audio";c="idle";d={TYPING:a,RECORDING_AUDIO:b};e={IDLE:c};f.TYPING=a;f.RECORDING_AUDIO=b;f.IDLE=c;f.ACTIVE_CHAT_STATE_TYPE=d;f.IDLE_CHAT_STATE_TYPE=e}),66);
__d("MWV2DualSendMessageContent.bs",["MAWVault"],(function(a,b,c,d,e,f,g){"use strict";var h="8031ded1058446aa93ccf8dace0eaf876dd5e32771904d5eb0058a0afdc724ce120dcba542d84548ac3f4a2741c45c0d",i="9031ded1058446aa93ccf8dace0eaf876dd5e32771904d5eb0058a0afdc724ce120dcba542d84548ac3f4a2741c45c0d";function a(a){if(a==null)return!1;a=d("MAWVault").unvault(a);if(a.endsWith(h))return!0;else return a.endsWith(i)}g.messageTextV2=i;g.isDualSend=a}),98);
__d("WAOfflineUtils",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=b("$InternalEnum").Mirrored(["INIT","OFFLINE_RESUME","ONLINE"]);c=b("$InternalEnum")({Initializing:"initializing",Failed:"failed",Processing:"processing",Complete:"complete"});f.ServerRPCMode=a;f.OfflineStatus=c}),66);
__d("IGDSetupBridge",["LSDatabaseSingleton","LSInitSyncCompleteSubscription","MAWBridgeUIEventHandler","MAWCommonSetupBridge","MAWCryptoAuthToken","MAWMainThreadLogger","MAWSetupBridgeOfflineSnapshot","Run","asyncToGeneratorRuntime","cr:1265","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("ArmadilloCutoverClientFalcoEvent").__setRef("IGDSetupBridge"),i=c("requireDeferred")("MAWSetupBridgeOfflineConsumer").__setRef("IGDSetupBridge"),j=c("LSDatabaseSingleton").then(d("LSInitSyncCompleteSubscription").use).then(function(){return c("LSDatabaseSingleton")}),k=function(a){h.loadImmediately(function(b){b=b.log;return b(function(){return{armadillo_thread_id:a.armadilloThreadId,domain:a.domain,event:a.event,event_details:a.eventDetails,open_thread_id:a.openThreadId,success:a.success,trace_id:a.traceId}})})};function a(a){var e=a.dispatch,f=a.environment,g=a.logout,h=a.reregisterDevice,l=a.worker;function m(){l.postMessage({type:"force-flush-data"})}d("Run").onUnload(m);d("Run").onBeforeUnload(m,!1);return d("MAWCommonSetupBridge").initBridge({customizeEventHandlers:{flushLogs:function(a){return d("MAWMainThreadLogger").logToHistoryInBulk(a.logs)},logCutoverEvent:k,logout:g,offlineConsumerProgress:function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){return(yield i.load())(j,e).apply(void 0,arguments)});function c(){return a.apply(this,arguments)}return c}(),offlineSnapshot:c("MAWSetupBridgeOfflineSnapshot"),reregisterDevice:h,rotateCryptoAuthToken:function(){return d("MAWCryptoAuthToken").fetchFreshCAT(f)},uiUpdate:function(a){a=a.events;e&&a.forEach(function(a){return e(a)});b("cr:1265")==null?void 0:b("cr:1265").recordBridgeUIEvent(a);d("MAWBridgeUIEventHandler").handleEvents(j,a)}},worker:l})}g.setupBridge=a}),98);
__d("IGDAWSetup.react",["CometRelayEnvironmentProvider","FBLogger","IGDSetupBridge","MAWCurrentUser","MAWSetupImpl.react","MAWStateContextProvider.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i=d("react").useCallback;function a(a){a=a.children;var b=i(function(){c("FBLogger")("igd_web_on_msgr").warn("Logout not implemented for IGD")},[]);return h.jsx("div",{className:"xjp7ctv","data-testid":void 0,children:h.jsx(c("CometRelayEnvironmentProvider"),{children:h.jsx(c("MAWStateContextProvider.react"),{children:h.jsx(c("MAWSetupImpl.react"),{fbid:d("MAWCurrentUser").getID(),logout:b,setupBridge:d("IGDSetupBridge").setupBridge,children:a})})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);